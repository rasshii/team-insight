# infrastructure/docker/backend/php.ini
# PHP 8.2設定ファイル - Mine-CMS用カスタム設定
#
# このファイルはPHPの動作を制御する設定ファイルです。
# 開発環境と本番環境で異なる設定が必要な項目については、
# 環境変数で切り替えられるようにすることが推奨されます。

# ===========================================
# 基本設定
# ===========================================
# PHPエンジンを有効化
engine = On

# 短いタグ（<? ?>）を無効化
# セキュリティと互換性のため、常に <?php ?> を使用
short_open_tag = Off

# ASPスタイルのタグを無効化
asp_tags = Off

# 浮動小数点の精度
precision = 14

# 出力バッファリング
# 4096バイトのバッファを使用
output_buffering = 4096

# ===========================================
# リソース制限
# ===========================================
# 最大実行時間（秒）
# 開発環境では長めに設定（デバッグ時に便利）
max_execution_time = 300

# 最大入力時間（秒）
# 大きなファイルのアップロード時に重要
max_input_time = 300

# メモリ制限
# Laravelアプリケーションには256MB以上を推奨
memory_limit = 256M

# ===========================================
# エラーハンドリング
# ===========================================
# エラー報告レベル
# 開発環境では全てのエラーを表示
error_reporting = E_ALL

# エラー表示
# 開発環境ではOn、本番環境ではOff
display_errors = On

# 起動時のエラー表示
display_startup_errors = On

# エラーログ
log_errors = On

# エラーログの最大長
log_errors_max_len = 1024

# エラーログにHTMLタグを含めない
html_errors = On

# エラーログファイル
; error_log = /var/log/php/error.log

# ===========================================
# データハンドリング
# ===========================================
# POSTデータの最大サイズ
# ファイルアップロードを考慮して大きめに設定
post_max_size = 100M

# デフォルトのMIMEタイプ
default_mimetype = "text/html"

# デフォルトの文字エンコーディング
default_charset = "UTF-8"

# ===========================================
# ファイルアップロード
# ===========================================
# ファイルアップロードを許可
file_uploads = On

# アップロードファイルの最大サイズ
upload_max_filesize = 100M

# 同時アップロード可能なファイル数
max_file_uploads = 20

# ===========================================
# パスとディレクトリ
# ===========================================
# インクルードパス
; include_path = ".:/usr/share/php"

# ドキュメントルート
; doc_root =

# ユーザーディレクトリ
; user_dir =

# 一時ファイルディレクトリ
; sys_temp_dir = "/tmp"

# ===========================================
# 動的拡張
# ===========================================
# 拡張機能のディレクトリ
; extension_dir = "/usr/local/lib/php/extensions/"

# ===========================================
# セッション設定
# ===========================================
# セッションハンドラー
# Redisを使用する場合は "redis" に変更
session.save_handler = files

# セッション保存パス
session.save_path = "/var/lib/php/sessions"

# セッションクッキー名
session.name = MINE_CMS_SESSION

# セッションの自動開始
session.auto_start = 0

# セッションクッキーの有効期限（0 = ブラウザを閉じるまで）
session.cookie_lifetime = 86400

# セッションクッキーのパス
session.cookie_path = /

# セッションクッキーのドメイン
session.cookie_domain =

# HTTPSでのみセッションクッキーを送信
session.cookie_secure = Off

# JavaScriptからのアクセスを禁止
session.cookie_httponly = On

# SameSite属性
session.cookie_samesite = Lax

# セッションIDの長さ
session.sid_length = 32

# セッションの最大有効期間（秒）
session.gc_maxlifetime = 86400

# ===========================================
# セキュリティ設定
# ===========================================
# グローバル変数の自動登録を無効化
register_globals = Off

# 外部エンティティの無効化
disable_functions = exec,passthru,shell_exec,system,proc_open,popen,parse_ini_file,show_source

# ファイルシステム関数でのURLを無効化
allow_url_fopen = On
allow_url_include = Off

# PHPバージョンの露出を防ぐ
expose_php = Off

# ===========================================
# 日付/時刻設定
# ===========================================
# デフォルトタイムゾーン
date.timezone = Asia/Tokyo

# ===========================================
# データベース設定
# ===========================================
# MySQLi
mysqli.max_persistent = -1
mysqli.allow_persistent = On
mysqli.max_links = -1
mysqli.cache_size = 2000
mysqli.default_port = 3306

# PDO MySQL
pdo_mysql.cache_size = 2000
pdo_mysql.default_socket=

# ===========================================
# メール設定
# ===========================================
# SMTP設定（開発環境ではMailhogを使用）
SMTP = mailhog
smtp_port = 1025

# sendmailパス
; sendmail_path = /usr/sbin/sendmail -t -i

# ===========================================
# その他の設定
# ===========================================
# URLリライト
cgi.fix_pathinfo = 0

# マルチバイト文字列設定
mbstring.language = Japanese
mbstring.internal_encoding = UTF-8
mbstring.http_output = UTF-8
mbstring.encoding_translation = Off
mbstring.detect_order = auto
mbstring.substitute_character = none

# OPcache設定（開発環境）
opcache.enable = 1
opcache.enable_cli = 1
opcache.memory_consumption = 128
opcache.interned_strings_buffer = 8
opcache.max_accelerated_files = 10000
opcache.revalidate_freq = 2
opcache.fast_shutdown = 1

# 開発環境では常にファイルの変更をチェック
opcache.validate_timestamps = 1

# Xdebug設定（開発環境のみ）
xdebug.mode = debug,develop,coverage
xdebug.client_host = host.docker.internal
xdebug.client_port = 9003
xdebug.start_with_request = yes
xdebug.log = /var/log/xdebug.log
