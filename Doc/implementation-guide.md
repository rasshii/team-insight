# Team Insight å®Ÿè£…ã‚¬ã‚¤ãƒ‰

## ç›®æ¬¡

1. [ã¯ã˜ã‚ã« - Team Insight ã¨ã¯ï¼Ÿ](#ã¯ã˜ã‚ã«---team-insight-ã¨ã¯)
2. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³](#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³)
3. [å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç†è§£ã—ã‚ˆã†](#å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç†è§£ã—ã‚ˆã†)
4. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²)
5. [å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®è©³ç´°è§£èª¬](#å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®è©³ç´°è§£èª¬)
6. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬)
7. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬)
8. [D3.js ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–](#d3js-ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–)
9. [é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
10. [ä»Šå¾Œã®å®Ÿè£…è¨ˆç”»](#ä»Šå¾Œã®å®Ÿè£…è¨ˆç”»)
11. [ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹](#ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)
12. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ã¯ã˜ã‚ã« - Team Insight ã¨ã¯ï¼Ÿ

Team Insight ã¯ã€é–‹ç™ºãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’å¯è¦–åŒ–ã—ã€ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ãŸæ„æ€æ±ºå®šã‚’æ”¯æ´ã™ã‚‹ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é€šã˜ã¦ã€ãƒ¢ãƒ€ãƒ³ãª Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã®å®Ÿè·µçš„ãªã‚¹ã‚­ãƒ«ã‚’èº«ã«ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### Team Insight ãŒè§£æ±ºã™ã‚‹å•é¡Œ

é–‹ç™ºç¾å ´ã§ã‚ˆãã‚ã‚‹å•é¡Œã‚’è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚å¤šãã®ãƒãƒ¼ãƒ ãŒã€Œãªã‚“ã¨ãªãå¿™ã—ã„ã€ã¨æ„Ÿã˜ãªãŒã‚‰ã‚‚ã€å…·ä½“çš„ã«ã©ã“ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã„ã‚‹ã®ã‹ã€èª°ã®è² è·ãŒé«˜ã„ã®ã‹ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯å¥å…¨ã«é€²ã‚“ã§ã„ã‚‹ã®ã‹ã‚’æŠŠæ¡ã§ãã¦ã„ã¾ã›ã‚“ã€‚

```mermaid
graph TB
    subgraph "ã‚ˆãã‚ã‚‹èª²é¡Œ"
        A[æ„Ÿè¦šçš„ãªçŠ¶æ³æŠŠæ¡]
        B[ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ç‰¹å®šå›°é›£]
        C[å€‹äººãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä¸æ˜]
        D[æ”¹å–„ç‚¹ãŒè¦‹ãˆãªã„]
    end

    subgraph "Team Insightã®è§£æ±ºç­–"
        E[ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãåˆ†æ]
        F[è‡ªå‹•æ¤œå‡ºã¨å¯è¦–åŒ–]
        G[å®¢è¦³çš„ãªæŒ‡æ¨™æä¾›]
        H[å…·ä½“çš„ãªæ”¹å–„ææ¡ˆ]
    end

    A --> E
    B --> F
    C --> G
    D --> H

    E --> I[çµ„ç¹”å…¨ä½“ã®ç”Ÿç”£æ€§å‘ä¸Š]
    F --> I
    G --> I
    H --> I

    style A fill:#ffccbc
    style B fill:#ffccbc
    style C fill:#ffccbc
    style D fill:#ffccbc
    style E fill:#c5e1a5
    style F fill:#c5e1a5
    style G fill:#c5e1a5
    style H fill:#c5e1a5
    style I fill:#fff9c4
```

### 3 ã¤ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ­ãƒ¼ãƒ«ã¨æä¾›ä¾¡å€¤

Team Insight ã¯ã€çµ„ç¹”ã®éšå±¤ã«å¿œã˜ã¦ç•°ãªã‚‹ä¾¡å€¤ã‚’æä¾›ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å®Ÿéš›ã®é–‹ç™ºç¾å ´ã§ã¯ç«‹å ´ã«ã‚ˆã£ã¦å¿…è¦ãªæƒ…å ±ãŒç•°ãªã‚‹ãŸã‚ã§ã™ã€‚

| ãƒ­ãƒ¼ãƒ«                   | ä¸»ãªåˆ©ç”¨è€…                     | æä¾›ä¾¡å€¤                                               | ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªç”»é¢                |
| ------------------------ | ------------------------------ | ------------------------------------------------------ | --------------------------------- |
| **ãƒ¡ãƒ³ãƒãƒ¼**             | é–‹ç™ºè€…ã€ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ç­‰           | è‡ªèº«ã®ä½œæ¥­åŠ¹ç‡ã‚’æŠŠæ¡ã—ã€å€‹äººã®æˆé•·ã‚’ä¿ƒé€²               | å€‹äººãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰                |
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒ¼ãƒ€ãƒ¼** | ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ‰ã€ã‚¹ã‚¯ãƒ©ãƒ ãƒã‚¹ã‚¿ãƒ¼ | ãƒãƒ¼ãƒ ã®å¥åº·çŠ¶æ…‹ã‚’ç›£è¦–ã—ã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’æ—©æœŸç™ºè¦‹       | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ + å€‹äºº |
| **ç®¡ç†è€…**               | é–‹ç™ºãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã€CTO          | çµ„ç¹”å…¨ä½“ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åˆ†æã—ã€ãƒªã‚½ãƒ¼ã‚¹é…åˆ†ã‚’æœ€é©åŒ– | ã™ã¹ã¦ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰            |

---

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

2024 å¹´ 12 æœˆæ™‚ç‚¹ã§ã€Team Insight ã® MVPï¼ˆæœ€å°é™ã®å®Ÿç”¨çš„ãªè£½å“ï¼‰é–‹ç™ºã¯é †èª¿ã«é€²ã‚“ã§ã„ã¾ã™ã€‚ã“ã“ã§ã¯ã€ä½•ãŒå®Œæˆã—ã¦ã„ã¦ã€ä½•ãŒã“ã‚Œã‹ã‚‰ãªã®ã‹ã‚’æ˜ç¢ºã«ã—ã¾ã™ã€‚

### âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ï¼ˆã‚‚ã†å‹•ã„ã¦ã„ã‚‹ï¼ï¼‰

ä»¥ä¸‹ã®æ©Ÿèƒ½ã¯ã™ã§ã«å®Ÿè£…ãŒå®Œäº†ã—ã€å‹•ä½œç¢ºèªæ¸ˆã¿ã§ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚€éš›ã¯ã€ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚

```mermaid
graph LR
    subgraph "èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  âœ…"
        A1[Backlog OAuth 2.0]
        A2[JWTèªè¨¼]
        A3[Cookieã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†]
        A4[Middlewareèªè¨¼]
    end

    subgraph "åŸºæœ¬ç”»é¢ âœ…"
        B1[ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸]
        B2[ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸]
        B3[ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸]
        B4[ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰åŸºç›¤]
        B5[å€‹äººãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰]
    end

    subgraph "ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API âœ…"
        C1[èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ]
        C2[ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†]
        C3[ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†]
        C4[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£]
    end

    subgraph "UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ âœ…"
        D1[BottleneckChart]
        D2[ThroughputChart]
        D3[KpiSummary]
        D4[FilterBar]
    end

    style A1 fill:#c5e1a5
    style A2 fill:#c5e1a5
    style A3 fill:#c5e1a5
    style A4 fill:#c5e1a5
    style B1 fill:#c5e1a5
    style B2 fill:#c5e1a5
    style B3 fill:#c5e1a5
    style B4 fill:#c5e1a5
    style B5 fill:#c5e1a5
    style C1 fill:#c5e1a5
    style C2 fill:#c5e1a5
    style C3 fill:#c5e1a5
    style C4 fill:#c5e1a5
    style D1 fill:#c5e1a5
    style D2 fill:#c5e1a5
    style D3 fill:#c5e1a5
    style D4 fill:#c5e1a5
```

### ğŸš§ å®Ÿè£…ä¸­/æœªå®Ÿè£…æ©Ÿèƒ½ï¼ˆã“ã‚Œã‹ã‚‰ä½œã‚‹ï¼ï¼‰

ã“ã‚Œã‹ã‚‰å®Ÿè£…ã™ã‚‹æ©Ÿèƒ½ã¨ã€ãã®å„ªå…ˆé †ä½ã‚’ç†è§£ã—ã¦ãŠãã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒãŒè¦‹ãˆã¦ãã¾ã™ã€‚

| æ©Ÿèƒ½                     | å„ªå…ˆåº¦ | æ¨å®šä½œæ¥­æ—¥æ•° | ãªãœå¿…è¦ï¼Ÿ                               |
| ------------------------ | ------ | ------------ | ---------------------------------------- |
| **Backlog API é€£æº**     | æœ€é«˜   | 3-4 æ—¥       | å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ãƒ»åˆ†æã™ã‚‹ãŸã‚         |
| **æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **     | é«˜     | 3-4 æ—¥       | ãƒ­ãƒ¼ãƒ«ã«å¿œã˜ãŸé©åˆ‡ãªæƒ…å ±ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®Ÿç¾   |
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠ UI**  | é«˜     | 1-2 æ—¥       | è¤‡æ•°ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã¦åˆ†æã™ã‚‹ãŸã‚ |
| **D3.js é«˜åº¦ãªãƒãƒ£ãƒ¼ãƒˆ** | ä¸­-é«˜  | 3-4 æ—¥       | ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ„Ÿçš„ã«ç†è§£ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ |
| **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**   | ä¸­-é«˜  | 2-3 æ—¥       | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Šã¨ãƒ‡ãƒãƒƒã‚°ã®åŠ¹ç‡åŒ–     |
| **å€‹äººåˆ¥ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³**   | ä¸­     | 2-3 æ—¥       | ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å€‹åˆ¥ã®è©³ç´°åˆ†æ             |
| **é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ **         | ä½-ä¸­  | 3-4 æ—¥       | é‡è¦ãªå¤‰åŒ–ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æŠŠæ¡           |

### URL æ§‹æˆã¨ç”»é¢è¨­è¨ˆ

Team Insight ã®ç”»é¢æ§‹æˆã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚âœ… ã¯å®Ÿè£…æ¸ˆã¿ã€ğŸš§ ã¯ä¸€éƒ¨å®Ÿè£…ã€ğŸ“‹ ã¯æœªå®Ÿè£…ã§ã™ã€‚

```mermaid
graph TD
    subgraph "å…¬é–‹ã‚¨ãƒªã‚¢ï¼ˆèª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰"
        A["/ ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ âœ…"]
        B["/auth/login ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ âœ…"]
        C["/auth/callback èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ âœ…"]
    end

    subgraph "èªè¨¼ã‚¨ãƒªã‚¢ï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¿…è¦ï¼‰"
        D["/dashboard ãƒ›ãƒ¼ãƒ  âœ…"]
        E["/dashboard/personal å€‹äººåˆ†æ ğŸš§"]
        F["/dashboard/project/:id ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†æ ğŸ“‹"]
        G["/dashboard/organization çµ„ç¹”åˆ†æ ğŸ“‹"]
        H["/projects ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ âœ…"]
    end

    subgraph "ç®¡ç†ã‚¨ãƒªã‚¢ï¼ˆç®¡ç†è€…ã®ã¿ï¼‰"
        I["/admin/users ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† ğŸ“‹"]
        J["/admin/settings è¨­å®š ğŸ“‹"]
    end

    A --> B
    B --> C
    C --> D
    D --> E
    D --> F
    D --> G
    D --> H

    style A fill:#c5e1a5
    style B fill:#c5e1a5
    style C fill:#c5e1a5
    style D fill:#c5e1a5
    style E fill:#fff9c4
    style F fill:#ffccbc
    style G fill:#ffccbc
    style H fill:#c5e1a5
    style I fill:#ffccbc
    style J fill:#ffccbc
```

---

## å…¨ä½“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’ç†è§£ã—ã‚ˆã†

Team Insight ã¯ã€ãƒ¢ãƒ€ãƒ³ãª Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¸å‹çš„ãª 3 å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚å„å±¤ã®å½¹å‰²ã¨ã€ãªãœã“ã®ã‚ˆã†ãªæ§‹æˆã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒã€åŠ¹ç‡çš„ãªé–‹ç™ºã®ç¬¬ä¸€æ­©ã§ã™ã€‚

```mermaid
graph TB
    subgraph "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹éƒ¨åˆ†ï¼‰"
        A[Webãƒ–ãƒ©ã‚¦ã‚¶]
        B[Next.js Frontend<br>React 18 + TypeScript]
        C[React Components]
        D[D3.js Charts]
    end

    subgraph "ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤ï¼ˆå‡¦ç†ã®ä¸­å¿ƒï¼‰"
        E[Redux Store<br>çŠ¶æ…‹ç®¡ç†]
        F[Custom Hooks<br>ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨]
        G[Services<br>APIé€šä¿¡]
        H[Middleware<br>èªè¨¼åˆ¶å¾¡]
    end

    subgraph "ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã¨å–å¾—ï¼‰"
        I[FastAPI Backend<br>Python 3.11+]
        J[PostgreSQL Database]
        K[Redis Cache<br>ï¼ˆå°†æ¥å®Ÿè£…ï¼‰]
    end

    subgraph "å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹"
        L[Backlog API]
    end

    A --> B
    B --> C
    C --> D
    C --> F
    F --> E
    F --> G
    G --> I
    H --> I
    I --> J
    I --> K
    I --> L

    style A fill:#e1f5fe
    style B fill:#c5e1a5
    style E fill:#d1c4e9
    style I fill:#fff9c4
    style L fill:#ffccbc
```

### ãªãœã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãªã®ã‹ï¼Ÿ

ã“ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªåˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œãã‚Œã®åˆ©ç‚¹ã«ã¤ã„ã¦ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã¨ç…§ã‚‰ã—åˆã‚ã›ãªãŒã‚‰ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

#### 1. **é–¢å¿ƒã®åˆ†é›¢ï¼ˆSeparation of Concernsï¼‰**

å„å±¤ãŒç‰¹å®šã®è²¬ä»»ã‚’æŒã¤ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ãŒæ•´ç†ã•ã‚Œã¾ã™ã€‚ä¾‹ãˆã°ã€èªè¨¼å‡¦ç†ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ï¼š

- **Component å±¤**: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºã®ã¿ï¼ˆ`LoginContent.tsx`ï¼‰
- **Service å±¤**: API é€šä¿¡ã®è©³ç´°ï¼ˆ`auth.service.ts`ï¼‰
- **Store å±¤**: èªè¨¼çŠ¶æ…‹ã®ç®¡ç†ï¼ˆ`authSlice.ts`ï¼‰
- **Hook å±¤**: ã“ã‚Œã‚‰ã‚’ã¤ãªããƒ­ã‚¸ãƒƒã‚¯ï¼ˆ`useAuth.ts`ï¼‰

#### 2. **å†åˆ©ç”¨æ€§ã®å‘ä¸Š**

Services ã‚„ Hooks ã¯è¤‡æ•°ã®å ´æ‰€ã§ä½¿ã„å›ã›ã¾ã™ã€‚ä¾‹ãˆã°ã€`authService`ã¯è¤‡æ•°ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã™ã“ã¨ãŒã§ãã€åŒã˜èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½•åº¦ã‚‚æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

#### 3. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**

å„å±¤ã‚’ç‹¬ç«‹ã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå¢—ãˆãŸå ´åˆï¼š

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ CDN ã§é…ä¿¡
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ã§è² è·åˆ†æ•£
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¯ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

#### 4. **ä¿å®ˆæ€§**

ã©ã“ã«ä½•ãŒã‚ã‚‹ã‹æ˜ç¢ºãªã®ã§ã€æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼ã‚‚ç†è§£ã—ã‚„ã™ãã€ãƒã‚°ã®ä¿®æ­£ã‚„æ©Ÿèƒ½è¿½åŠ ãŒå®¹æ˜“ã§ã™ã€‚

---

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã¨å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ã‚’ç†è§£ã™ã‚‹ã“ã¨ã¯ã€åŠ¹ç‡çš„ãªé–‹ç™ºã®ç¬¬ä¸€æ­©ã§ã™ã€‚å„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¨ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã‚’è©³ã—ãè¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€ ï¼ˆè©³ç´°ç‰ˆï¼‰

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                    # Next.js 13+ App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx         # å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®šç¾©
â”‚   â”‚   â”œâ”€â”€ page.tsx           # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆ/ï¼‰
â”‚   â”‚   â”œâ”€â”€ providers.tsx      # Reduxç­‰ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼è¨­å®š
â”‚   â”‚   â”œâ”€â”€ globals.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ auth/              # èªè¨¼é–¢é€£ã®ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginContent.tsx      # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®å®Ÿè£…
â”‚   â”‚   â”‚   â””â”€â”€ callback/
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx              # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒšãƒ¼ã‚¸ã®ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â”‚       â””â”€â”€ AuthCallbackContent.tsx # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã®å®Ÿè£…
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dashboard/         # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆèªè¨¼å¿…è¦ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx       # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚   â”œâ”€â”€ personal/      # å€‹äººåˆ†æ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx  # å€‹äººãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆå®Ÿè£…æ¸ˆã¿ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ project/       # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆ†æ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/     # å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ organization/  # çµ„ç¹”åˆ†æï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ projects/          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx       # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/             # ç®¡ç†ç”»é¢ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ users/         # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ settings/      # è¨­å®šç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ api/               # APIãƒ«ãƒ¼ãƒˆï¼ˆNext.js API Routesï¼‰
â”‚   â”‚       â”œâ”€â”€ config.ts      # APIè¨­å®š
â”‚   â”‚       â”œâ”€â”€ dashboard/     # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰API
â”‚   â”‚       â”‚   â””â”€â”€ route.ts   # GET /api/dashboard
â”‚   â”‚       â”œâ”€â”€ projects/      # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAPI
â”‚   â”‚       â”‚   â””â”€â”€ route.ts   # GET /api/projects
â”‚   â”‚       â””â”€â”€ teams/         # ãƒãƒ¼ãƒ API
â”‚   â”‚           â””â”€â”€ route.ts   # GET /api/teams
â”‚   â”‚
â”‚   â”œâ”€â”€ components/            # å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ui/               # åŸºæœ¬çš„ãªUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆshadcn/uiï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ alert.tsx     # ã‚¢ãƒ©ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx    # ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx      # ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ loading-spinner.tsx # ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
â”‚   â”‚   â”‚   â””â”€â”€ ...          # ãã®ä»–ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Layout.tsx        # å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ PrivateRoute.tsx  # èªè¨¼ä¿è­·ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ dashboard/        # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ç”¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚       â”œâ”€â”€ BottleneckChart.tsx     # ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æãƒãƒ£ãƒ¼ãƒˆï¼ˆD3.jsï¼‰
â”‚   â”‚       â”œâ”€â”€ ThroughputChart.tsx     # ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆãƒãƒ£ãƒ¼ãƒˆ
â”‚   â”‚       â”œâ”€â”€ KpiSummary.tsx          # KPIã‚µãƒãƒªãƒ¼
â”‚   â”‚       â””â”€â”€ FilterBar.tsx           # ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒãƒ¼
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ useAuth.ts       # èªè¨¼é–¢é€£ã®ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ use-toast.ts     # ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ useProjects.ts   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”œâ”€â”€ useAnalytics.ts  # åˆ†æãƒ‡ãƒ¼ã‚¿é–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ usePermission.ts # æ¨©é™ç®¡ç†ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/            # APIé€šä¿¡ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â”œâ”€â”€ auth.service.ts  # èªè¨¼APIé€šä¿¡
â”‚   â”‚   â”œâ”€â”€ project.service.ts # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆAPIï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ analytics.service.ts # åˆ†æAPIï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ store/               # ReduxçŠ¶æ…‹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.ts        # ã‚¹ãƒˆã‚¢è¨­å®š
â”‚   â”‚   â”œâ”€â”€ hooks.ts        # å‹ä»˜ããƒ•ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ slices/         # å„æ©Ÿèƒ½ã®ã‚¹ãƒ©ã‚¤ã‚¹
â”‚   â”‚       â”œâ”€â”€ authSlice.ts      # èªè¨¼çŠ¶æ…‹
â”‚   â”‚       â”œâ”€â”€ projectSlice.ts   # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ…‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚       â”œâ”€â”€ analyticsSlice.ts # åˆ†æãƒ‡ãƒ¼ã‚¿çŠ¶æ…‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚       â””â”€â”€ uiSlice.ts        # UIçŠ¶æ…‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ utils.ts        # æ±ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ api-client.ts   # APIé€šä¿¡ã®å…±é€šå‡¦ç†ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ constants.ts    # å®šæ•°å®šç¾©
â”‚   â”‚
â”‚   â”œâ”€â”€ types/              # TypeScriptå‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ period.ts       # æœŸé–“é–¢é€£ã®å‹
â”‚   â”‚   â”œâ”€â”€ api.ts         # APIé–¢é€£ã®å‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”œâ”€â”€ models.ts      # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ index.ts       # å‹ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts       # Next.jsãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ï¼ˆèªè¨¼ãƒã‚§ãƒƒã‚¯ï¼‰
â”‚
â”œâ”€â”€ public/                 # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ images/            # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ favicon.ico        # ãƒ•ã‚¡ãƒ“ã‚³ãƒ³
â”‚
â”œâ”€â”€ __tests__/             # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ components/        # ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ Layout.test.tsx
â”‚
â””â”€â”€ package.json           # ä¾å­˜é–¢ä¿‚ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ§‹é€ ï¼ˆè©³ç´°ç‰ˆï¼‰

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                 # APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ auth.py      # èªè¨¼é–¢é€£ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚       â”œâ”€â”€ projects.py  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚       â”œâ”€â”€ analytics.py # åˆ†æé–¢é€£ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚       â””â”€â”€ users.py     # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ core/               # ã‚³ã‚¢æ©Ÿèƒ½
â”‚   â”‚   â”œâ”€â”€ config.py       # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
â”‚   â”‚   â”œâ”€â”€ security.py     # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£ï¼ˆJWTç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ permissions.py  # æ¨©é™ç®¡ç†ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ dependencies.py # ä¾å­˜æ€§æ³¨å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢é€£
â”‚   â”‚   â”œâ”€â”€ base.py        # SQLAlchemyãƒ™ãƒ¼ã‚¹è¨­å®š
â”‚   â”‚   â”œâ”€â”€ base_class.py  # ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ session.py     # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒã‚·ãƒ§ãƒ³
â”‚   â”‚   â””â”€â”€ init_db.py     # åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥
â”‚   â”‚
â”‚   â”œâ”€â”€ models/             # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ user.py        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â”œâ”€â”€ auth.py        # èªè¨¼é–¢é€£ãƒ¢ãƒ‡ãƒ«ï¼ˆOAuthToken, OAuthStateï¼‰
â”‚   â”‚   â”œâ”€â”€ project.py     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¢ãƒ‡ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ analytics.py   # åˆ†æãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/            # Pydanticã‚¹ã‚­ãƒ¼ãƒï¼ˆå‹å®šç¾©ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ auth.py        # èªè¨¼é–¢é€£ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹
â”‚   â”‚   â”œâ”€â”€ user.py        # ãƒ¦ãƒ¼ã‚¶ãƒ¼é–¢é€£ã®å‹
â”‚   â”‚   â”œâ”€â”€ project.py     # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£ã®å‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ analytics.py   # åˆ†æé–¢é€£ã®å‹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ services/           # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ backlog_oauth.py    # Backlog OAuthå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ backlog_api.py      # Backlog APIé€£æºï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â”œâ”€â”€ analytics_service.py # åˆ†æã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚   â””â”€â”€ notification_service.py # é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ utils/              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ logging.py      # ãƒ­ã‚°è¨­å®š
â”‚
â”œâ”€â”€ migrations/            # Alembicãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ versions/          # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â”œâ”€â”€ 5333a4ae1265_create_users_and_oauth_tables.py
â”‚   â”‚   â”œâ”€â”€ 758e6b2ba560_move_tables_to_team_insight_schema.py
â”‚   â”‚   â””â”€â”€ 926f6717b64e_create_oauth_states_table.py
â”‚   â””â”€â”€ alembic.ini       # Alembicè¨­å®š
â”‚
â”œâ”€â”€ tests/                 # ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ conftest.py       # ãƒ†ã‚¹ãƒˆå…±é€šè¨­å®š
â”‚   â”œâ”€â”€ test_auth.py      # èªè¨¼ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_projects.py  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ†ã‚¹ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰
â”‚   â””â”€â”€ test_analytics.py # åˆ†æãƒ†ã‚¹ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰
â”‚
â”œâ”€â”€ requirements.txt       # æœ¬ç•ªç”¨ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ requirements-dev.txt   # é–‹ç™ºç”¨ä¾å­˜é–¢ä¿‚
â””â”€â”€ .env.example          # ç’°å¢ƒå¤‰æ•°ã®ä¾‹
```

### å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã¨è²¬ä»»

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

1. **app/**: ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

   ```typescript
   // app/page.tsx - ãƒ«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã®ä¾‹
   export default function HomePage() {
     // ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯UIã®è¡¨ç¤ºã«å°‚å¿µ
     return <div>Welcome to Team Insight</div>;
   }
   ```

2. **components/**: å†åˆ©ç”¨å¯èƒ½ãª UI ãƒ‘ãƒ¼ãƒ„

   ```typescript
   // components/ui/button.tsx - å†åˆ©ç”¨å¯èƒ½ãªãƒœã‚¿ãƒ³
   export function Button({ children, onClick, variant = "default" }) {
     // UIãƒ­ã‚¸ãƒƒã‚¯ã®ã¿ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯å«ã¾ãªã„
     return (
       <button className={styles[variant]} onClick={onClick}>
         {children}
       </button>
     );
   }
   ```

3. **hooks/**: ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨

   ```typescript
   // hooks/useAuth.ts - èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚«ãƒ—ã‚»ãƒ«åŒ–
   export function useAuth() {
     // çŠ¶æ…‹ç®¡ç†ã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ©‹æ¸¡ã—
     // è¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã‚’éš è”½
   }
   ```

4. **services/**: API é€šä¿¡

   ```typescript
   // services/auth.service.ts - APIé€šä¿¡ã®è©³ç´°ã‚’éš è”½
   class AuthService {
     async login(credentials) {
       // HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°
       // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
     }
   }
   ```

5. **store/**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®çŠ¶æ…‹
   ```typescript
   // store/slices/authSlice.ts - èªè¨¼çŠ¶æ…‹ã®ç®¡ç†
   const authSlice = createSlice({
     name: "auth",
     initialState: { user: null, isAuthenticated: false },
     reducers: {
       // çŠ¶æ…‹ã®æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
     },
   });
   ```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

1. **api/**: HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

   ```python
   # api/v1/auth.py - èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
   @router.post("/login")
   async def login(credentials: LoginRequest):
       # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å—ä»˜ã¨æ¤œè¨¼
       # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ•´å½¢
   ```

2. **models/**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

   ```python
   # models/user.py - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
   class User(BaseModel):
       __tablename__ = "users"
       # ã‚«ãƒ©ãƒ å®šç¾©
       # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾©
   ```

3. **schemas/**: ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

   ```python
   # schemas/auth.py - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹
   class LoginRequest(BaseModel):
       username: str
       password: str
       # PydanticãŒè‡ªå‹•çš„ã«å‹ãƒã‚§ãƒƒã‚¯
   ```

4. **services/**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
   ```python
   # services/backlog_oauth.py - OAuthå‡¦ç†
   class BacklogOAuthService:
       # è¤‡é›‘ãªèªè¨¼ãƒ•ãƒ­ãƒ¼ã®å®Ÿè£…
       # å¤–éƒ¨APIã¨ã®é€£æº
   ```

---

## å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ã®è©³ç´°è§£èª¬

å®Ÿè£…æ¸ˆã¿ã®æ©Ÿèƒ½ã«ã¤ã„ã¦ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ãªãŒã‚‰ã€ãªãœãã®ã‚ˆã†ãªå®Ÿè£…ã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ç†è§£ã—ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

### èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ç†è§£

èªè¨¼ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è¦ã§ã™ã€‚Team Insight ã¯ OAuth 2.0 ã‚’ä½¿ç”¨ã—ã¦å®‰å…¨ãªèªè¨¼ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚ã“ã“ã§ã¯ã€èªè¨¼ãƒ•ãƒ­ãƒ¼å…¨ä½“ã‚’è©³ã—ãè¦‹ã¦ã„ãã¾ã™ã€‚

#### ãªãœ OAuth 2.0 ã‚’ä½¿ã†ã®ã‹ï¼Ÿ

å¾“æ¥ã®èªè¨¼æ–¹å¼ã¨ OAuth 2.0 ã®é•ã„ã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®é‡è¦æ€§ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

```mermaid
graph LR
    subgraph "å¾“æ¥ã®èªè¨¼ï¼ˆå±é™ºï¼‰"
        A1[ãƒ¦ãƒ¼ã‚¶ãƒ¼] -->|ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›| B1[Team Insight]
        B1 -->|ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä¿å­˜| C1[ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹]
        C1 -->|æ¼æ´©ãƒªã‚¹ã‚¯| D1[å±é™ºï¼]
    end

    subgraph "OAuth 2.0ï¼ˆå®‰å…¨ï¼‰"
        A2[ãƒ¦ãƒ¼ã‚¶ãƒ¼] -->|Backlogã§èªè¨¼| B2[Backlog]
        B2 -->|ãƒˆãƒ¼ã‚¯ãƒ³ã®ã¿| C2[Team Insight]
        C2 -->|ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜| D2[å®‰å…¨ï¼]
    end

    style D1 fill:#ff6b6b
    style D2 fill:#51cf66
```

OAuth 2.0 ã®åˆ©ç‚¹ï¼š

1. **ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ãªã„**: Team Insight ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’çŸ¥ã‚‰ãªã„
2. **æ¨©é™ã®ç´°åˆ†åŒ–**: å¿…è¦ãªæ¨©é™ã®ã¿ã‚’è¦æ±‚ã§ãã‚‹
3. **å–ã‚Šæ¶ˆã—å¯èƒ½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¤ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹æ¨©ã‚’å–ã‚Šæ¶ˆã›ã‚‹
4. **æ¨™æº–åŒ–**: å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ã§æ¡ç”¨ã•ã‚Œã¦ã„ã‚‹æ¨™æº–çš„ãªæ–¹æ³•

#### èªè¨¼ãƒ•ãƒ­ãƒ¼ã®è©³ç´°

```mermaid
sequenceDiagram
    participant U as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant F as ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    participant B as ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
    participant BL as Backlog API
    participant DB as ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹

    Note over U,DB: Step 1: ãƒ­ã‚°ã‚¤ãƒ³é–‹å§‹
    U->>F: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    F->>B: GET /api/v1/auth/backlog/authorize
    B->>DB: stateã‚’ä¿å­˜ï¼ˆCSRFå¯¾ç­–ï¼‰
    DB-->>B: ä¿å­˜å®Œäº†
    B-->>F: {authorization_url, state}
    F->>U: Backlogã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

    Note over U,DB: Step 2: Backlogèªè¨¼
    U->>BL: ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±å…¥åŠ›
    BL->>U: èªè¨¼ãƒ»æ‰¿èªç”»é¢
    U->>BL: æ‰¿èª
    BL-->>F: /auth/callback?code=xxx&state=yyy

    Note over U,DB: Step 3: ãƒˆãƒ¼ã‚¯ãƒ³äº¤æ›
    F->>B: POST /api/v1/auth/backlog/callback
    B->>DB: stateæ¤œè¨¼
    DB-->>B: stateæœ‰åŠ¹
    B->>BL: POST /api/v2/oauth2/token (codeã‚’é€ä¿¡)
    BL-->>B: {access_token, refresh_token}
    B->>BL: GET /api/v2/users/myself
    BL-->>B: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    B->>DB: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ/æ›´æ–°
    B->>DB: ãƒˆãƒ¼ã‚¯ãƒ³ä¿å­˜
    B-->>F: JWT + Set-Cookie

    Note over U,DB: Step 4: èªè¨¼å®Œäº†
    F->>F: Storeã«ä¿å­˜
    F->>U: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§»
```

#### Step 1: èªè¨¼ URL ã®ç”Ÿæˆï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

```python
# backend/app/api/v1/auth.py

from fastapi import APIRouter, Depends, HTTPException
from datetime import datetime, timedelta
import secrets

router = APIRouter(prefix="/auth", tags=["authentication"])

@router.get("/backlog/authorize")
async def get_authorization_url(db: Session = Depends(get_db)):
    """
    Step 1: èªè¨¼URLã‚’ç”Ÿæˆã™ã‚‹

    ãªãœã“ã®å‡¦ç†ãŒå¿…è¦ï¼Ÿ
    - CSRFæ”»æ’ƒã‚’é˜²ããŸã‚ã®state parameterã‚’ç”Ÿæˆ
    - Backlogã®èªè¨¼ç”»é¢ã¸ã®URLã‚’æ§‹ç¯‰
    """
    # ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ï¼ˆstateï¼‰ã‚’ç”Ÿæˆ
    # ã“ã‚Œã«ã‚ˆã‚Šã€æ‚ªæ„ã®ã‚ã‚‹ç¬¬ä¸‰è€…ã‹ã‚‰ã®å½è£…ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ã’ã‚‹
    state = secrets.token_urlsafe(32)

    # stateã‚’ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆ10åˆ†é–“æœ‰åŠ¹ï¼‰
    # å¾Œã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã«æ¤œè¨¼ã™ã‚‹ãŸã‚
    oauth_state = OAuthState(
        state=state,
        expires_at=datetime.utcnow() + timedelta(minutes=10)
    )
    db.add(oauth_state)
    db.commit()

    # Backlogã®èªè¨¼URLã‚’æ§‹ç¯‰
    auth_url = (
        f"https://{settings.BACKLOG_SPACE_KEY}.backlog.jp/OAuth2AccessRequest.action"
        f"?response_type=code"
        f"&client_id={settings.BACKLOG_CLIENT_ID}"
        f"&redirect_uri={settings.BACKLOG_REDIRECT_URI}"
        f"&state={state}"
    )

    return {"authorization_url": auth_url, "state": state}
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ³ãƒˆï¼š**

- **state**: ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã§ã€CSRFï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼‰æ”»æ’ƒã‚’é˜²ã
- **æœ‰åŠ¹æœŸé™**: 10 åˆ†å¾Œã«è‡ªå‹•çš„ã«ç„¡åŠ¹ã«ãªã‚Šã€å¤ã„ state ã®å†åˆ©ç”¨ã‚’é˜²ã
- **ãƒ­ã‚°**: å•é¡ŒãŒç™ºç”Ÿã—ãŸéš›ã®ãƒ‡ãƒãƒƒã‚°ã®ãŸã‚ã€é©åˆ‡ã«ãƒ­ã‚°ã‚’æ®‹ã™

#### Step 1: ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```typescript
// frontend/src/app/auth/login/LoginContent.tsx

"use client";

import { useAuth } from "@/hooks/useAuth";
import { Button } from "@/components/ui/button";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import { useRouter, useSearchParams } from "next/navigation";
import { useEffect, useState } from "react";
import { Loader2 } from "lucide-react";

export function LoginContent() {
  const { login, isAuthenticated, isInitialized } = useAuth();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
  useEffect(() => {
    if (isInitialized && isAuthenticated) {
      console.log("æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ");
      router.push("/dashboard");
    }
  }, [isAuthenticated, isInitialized, router]);

  const handleLogin = async () => {
    setIsLoading(true);
    setError(null);

    try {
      // Step 1: èªè¨¼URLã‚’å–å¾—ã—ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      console.log("ğŸ” ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã‚’é–‹å§‹");
      await login();
      // ã“ã®æ™‚ç‚¹ã§Backlogã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
    } catch (err: any) {
      console.error("âŒ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", err);
      setError(
        err.message || "ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"
      );
      setIsLoading(false);
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50">
      <Card className="w-full max-w-md">
        <CardHeader className="space-y-1">
          <CardTitle className="text-2xl font-bold text-center">
            Team Insight ã«ãƒ­ã‚°ã‚¤ãƒ³
          </CardTitle>
          <CardDescription className="text-center">
            Backlog ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Button
            onClick={handleLogin}
            disabled={isLoading}
            className="w-full"
            size="lg"
          >
            {isLoading ? (
              <>
                <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ãƒ­ã‚°ã‚¤ãƒ³ä¸­...
              </>
            ) : (
              <>
                <img
                  src="/backlog-logo.svg"
                  alt="Backlog"
                  className="mr-2 h-5 w-5"
                />
                Backlog ã§ãƒ­ã‚°ã‚¤ãƒ³
              </>
            )}
          </Button>

          {error && (
            <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded-md">
              <p className="text-sm text-red-600">{error}</p>
            </div>
          )}

          <div className="mt-6 text-center text-sm text-gray-600">
            <p>ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã™ï¼š</p>
            <ul className="mt-2 space-y-1">
              <li>âœ“ ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§åˆ†æ</li>
              <li>âœ“ ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®å¯è¦–åŒ–</li>
              <li>âœ“ å€‹äººãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æŠŠæ¡</li>
            </ul>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

**UI ã®ãƒã‚¤ãƒ³ãƒˆï¼š**

- **ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å‡¦ç†ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ç¤ºã™
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ†ã‹ã‚Šã‚„ã™ãè¡¨ç¤º
- **ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£**: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼å¯¾å¿œã®ãƒãƒ¼ã‚¯ã‚¢ãƒƒãƒ—

#### Step 2: Backlog èªè¨¼ç”»é¢

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ Backlog ã®èªè¨¼ç”»é¢ã§ä»¥ä¸‹ã®æ“ä½œã‚’è¡Œã„ã¾ã™ï¼š

1. Backlog ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›
2. Team Insight ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’ç¢ºèª
3. ã€Œæ‰¿èªã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯

ã“ã®éƒ¨åˆ†ã¯ Backlog å´ã®å®Ÿè£…ãªã®ã§ã€Team Insight ã§ã¯åˆ¶å¾¡ã§ãã¾ã›ã‚“ã€‚

#### Step 3: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```typescript
// frontend/src/app/auth/callback/page.tsx

"use client";

import { useEffect, useState } from "react";
import { useSearchParams, useRouter } from "next/navigation";
import { useAuth } from "@/hooks/useAuth";
import { Loader2 } from "lucide-react";

export default function AuthCallbackPage() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const { handleCallback } = useAuth();
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const processCallback = async () => {
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰èªè¨¼ã‚³ãƒ¼ãƒ‰ã¨stateã‚’å–å¾—
      const code = searchParams.get("code");
      const state = searchParams.get("state");
      const error = searchParams.get("error");
      const errorDescription = searchParams.get("error_description");

      // ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
      if (error) {
        console.error("âŒ Backlogèªè¨¼ã‚¨ãƒ©ãƒ¼:", error, errorDescription);
        setError(errorDescription || "èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
        return;
      }

      if (!code || !state) {
        console.error("âŒ å¿…è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä¸è¶³");
        setError("èªè¨¼æƒ…å ±ãŒä¸æ­£ã§ã™");
        return;
      }

      try {
        console.log("ğŸ”„ èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ä¸­...");

        // Step 3: èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«é€ä¿¡
        await handleCallback(code, state);

        console.log("âœ… èªè¨¼æˆåŠŸï¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§»");
        // æˆåŠŸã—ãŸã‚‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸
        router.push("/dashboard");
      } catch (err: any) {
        console.error("âŒ ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼:", err);
        setError(err.message || "èªè¨¼å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ");
      }
    };

    processCallback();
  }, [searchParams, handleCallback, router]);

  if (error) {
    return (
      <div className="flex min-h-screen items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold text-red-600 mb-4">èªè¨¼ã‚¨ãƒ©ãƒ¼</h1>
          <p className="text-gray-600 mb-6">{error}</p>
          <button
            onClick={() => router.push("/login")}
            className="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
          >
            ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="flex min-h-screen items-center justify-center">
      <div className="text-center">
        <Loader2 className="h-8 w-8 animate-spin mx-auto mb-4" />
        <p className="text-gray-600">èªè¨¼å‡¦ç†ä¸­...</p>
      </div>
    </div>
  );
}
```

**å®Ÿè£…ã®ãƒã‚¤ãƒ³ãƒˆï¼š**

- **äºŒé‡å®Ÿè¡Œé˜²æ­¢**: `useRef`ã‚’ä½¿ç”¨ã—ã¦ã€å‡¦ç†ãŒè¤‡æ•°å›å®Ÿè¡Œã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹
- **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¨ãƒ©ãƒ¼ã‹ã‚‰å›å¾©ã§ãã‚‹ã‚ˆã†ã€é©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æä¾›
- **UX**: å‡¦ç†ä¸­ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ç¤ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸å®‰ã‚’è»½æ¸›

#### Step 3: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

```python
# backend/app/api/v1/auth.py

@router.post("/backlog/callback")
async def handle_callback(
    request: CallbackRequest,
    db: Session = Depends(get_db)
):
    """
    Step 3: Backlog OAuth2.0èªè¨¼ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‡¦ç†

    å‡¦ç†ã®æµã‚Œï¼š
    1. stateãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼ï¼ˆCSRFå¯¾ç­–ï¼‰
    2. èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
    3. Backlogã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
    4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
    5. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã—ã¦è¿”ã™
    """
    logger.info(f"èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–‹å§‹ - state: {request.state}")

    # 1. stateã®æ¤œè¨¼
    oauth_state = db.query(OAuthState).filter(
        OAuthState.state == request.state
    ).first()

    if not oauth_state:
        logger.error(f"ç„¡åŠ¹ãªstateãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ - state: {request.state}")
        raise HTTPException(status_code=400, detail="ç„¡åŠ¹ãªstateãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã™")

    if oauth_state.is_expired():
        logger.error(f"stateãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æœ‰åŠ¹æœŸé™åˆ‡ã‚Œ - state: {request.state}")
        db.delete(oauth_state)
        db.commit()
        raise HTTPException(status_code=400, detail="stateã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™")

    try:
        # 2. èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
        token_data = await backlog_oauth_service.exchange_code_for_token(request.code)

        # 3. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
        user_info = await backlog_oauth_service.get_user_info(token_data["access_token"])

        # 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã¾ãŸã¯æ›´æ–°
        user = db.query(User).filter(User.backlog_id == user_info["id"]).first()
        if not user:
            # æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
            user = User(
                backlog_id=user_info["id"],
                email=user_info.get("mailAddress"),
                name=user_info["name"],
                user_id=user_info["userId"],
                is_active=True
            )
            db.add(user)
            db.commit()
            db.refresh(user)
        else:
            # æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’æ›´æ–°
            user.name = user_info["name"]
            user.email = user_info.get("mailAddress")
            db.commit()

        # 5. ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
        oauth_token = OAuthToken(
            user_id=user.id,
            provider="backlog",
            access_token=token_data["access_token"],
            refresh_token=token_data.get("refresh_token"),
            expires_at=datetime.utcnow() + timedelta(seconds=token_data.get("expires_in", 3600))
        )
        db.add(oauth_token)

        # 6. ä½¿ç”¨æ¸ˆã¿ã®stateã‚’å‰Šé™¤
        db.delete(oauth_state)
        db.commit()

        # 7. JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
        access_token = create_access_token(data={"sub": str(user.id)})

        logger.info(f"èªè¨¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸ - user_id: {user.id}")

        # 8. ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ä½œæˆï¼ˆHttpOnlyã‚¯ãƒƒã‚­ãƒ¼ã‚’è¨­å®šï¼‰
        return JSONResponse(
            content={
                "access_token": access_token,
                "token_type": "bearer",
                "user": {
                    "id": user.id,
                    "backlog_id": user.backlog_id,
                    "email": user.email,
                    "name": user.name,
                    "user_id": user.user_id
                }
            },
            headers={
                "Set-Cookie": f"auth_token={access_token}; "
                             f"Path=/; HttpOnly; SameSite=Lax; "
                             f"Max-Age=604800"  # 7æ—¥é–“
            }
        )

    except Exception as e:
        logger.error(f"èªè¨¼å‡¦ç†ã‚¨ãƒ©ãƒ¼: {str(e)}", exc_info=True)
        # ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚stateã‚’å‰Šé™¤ï¼ˆå†åˆ©ç”¨ã‚’é˜²ãï¼‰
        db.delete(oauth_state)
        db.commit()
        raise HTTPException(status_code=500, detail=f"èªè¨¼å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ: {str(e)}")
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒã‚¤ãƒ³ãƒˆï¼š**

1. **state æ¤œè¨¼**: CSRF æ”»æ’ƒã‚’é˜²ããŸã‚ã€å¿…ãšæ¤œè¨¼ã™ã‚‹
2. **ä½¿ç”¨æ¸ˆã¿ state ã®å‰Šé™¤**: å†åˆ©ç”¨æ”»æ’ƒã‚’é˜²ã
3. **HttpOnly ã‚¯ãƒƒã‚­ãƒ¼**: XSS æ”»æ’ƒã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å®ˆã‚‹
4. **é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã‚’æ¼ã‚‰ã•ãªã„

#### Step 4: JWT èªè¨¼ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

JWTï¼ˆJSON Web Tokenï¼‰ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã—ã¾ã™ã€‚

```python
# backend/app/core/security.py

from datetime import datetime, timedelta
from typing import Optional
from jose import JWTError, jwt
from passlib.context import CryptContext
from app.core.config import settings

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    """
    JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹

    ãªãœJWTã‚’ä½¿ã†ã®ã‹ï¼Ÿ
    - ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹: ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒãªã„
    - ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«: è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã§èªè¨¼æƒ…å ±ã‚’å…±æœ‰ã§ãã‚‹
    - è‡ªå·±å®Œçµçš„: ãƒˆãƒ¼ã‚¯ãƒ³è‡ªä½“ã«å¿…è¦ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹
    """
    to_encode = data.copy()

    # æœ‰åŠ¹æœŸé™ã‚’è¨­å®šï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7æ—¥é–“ï¼‰
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(days=7)

    to_encode.update({"exp": expire})

    # ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆï¼ˆç§˜å¯†éµã§ç½²åï¼‰
    encoded_jwt = jwt.encode(
        to_encode,
        settings.SECRET_KEY,
        algorithm=settings.ALGORITHM
    )

    return encoded_jwt

def verify_token(token: str) -> dict:
    """
    JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹

    æ¤œè¨¼é …ç›®ï¼š
    - ç½²åãŒæ­£ã—ã„ã‹
    - æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ãªã„ã‹
    - å¿…è¦ãªæƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹
    """
    try:
        payload = jwt.decode(
            token,
            settings.SECRET_KEY,
            algorithms=[settings.ALGORITHM]
        )
        return payload
    except JWTError:
        raise HTTPException(
            status_code=401,
            detail="èªè¨¼æƒ…å ±ãŒç„¡åŠ¹ã§ã™"
        )
```

#### Middleware ã«ã‚ˆã‚‹èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```typescript
// frontend/src/middleware.ts

import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";

// èªè¨¼ãŒå¿…è¦ãªãƒ‘ã‚¹
const protectedPaths = ["/dashboard", "/projects", "/admin"];

// èªè¨¼ãŒä¸è¦ãªãƒ‘ã‚¹
const publicPaths = ["/", "/auth/login", "/auth/callback"];

export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;

  // èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ç¢ºèª
  const authToken = request.cookies.get("auth_token");

  // ä¿è­·ã•ã‚ŒãŸãƒ‘ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ™‚
  if (protectedPaths.some((path) => pathname.startsWith(path))) {
    if (!authToken) {
      // èªè¨¼ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      const loginUrl = new URL("/auth/login", request.url);
      // ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã«å…ƒã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹
      loginUrl.searchParams.set("redirect", pathname);
      return NextResponse.redirect(loginUrl);
    }
  }

  // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆ
  if (publicPaths.includes(pathname) && authToken) {
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    return NextResponse.redirect(new URL("/dashboard", request.url));
  }

  return NextResponse.next();
}

export const config = {
  matcher: [
    /*
     * ä»¥ä¸‹ã‚’é™¤ãã™ã¹ã¦ã®ãƒ‘ã‚¹ã«ãƒãƒƒãƒ:
     * - api (API routes)
     * - _next/static (static files)
     * - _next/image (image optimization files)
     * - favicon.ico (favicon file)
     */
    "/((?!api|_next/static|_next/image|favicon.ico).*)",
  ],
};
```

### ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æã®å®Ÿè£…

ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æã¯ Team Insight ã®ä¸­æ ¸æ©Ÿèƒ½ã®ä¸€ã¤ã§ã™ã€‚D3.js ã‚’ä½¿ç”¨ã—ã¦ã€é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹ã®å„ã‚¹ãƒ†ãƒ¼ã‚¸ã§ã®æ»ç•™æ™‚é–“ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚

```typescript
// frontend/src/components/dashboard/BottleneckChart.tsx

import React, { useEffect, useRef, useState } from "react";
import * as d3 from "d3";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";

interface BottleneckData {
  stage: string;
  averageTime: number;
  taskCount: number;
  isBottleneck: boolean;
}

export function BottleneckChart() {
  const svgRef = useRef<SVGSVGElement>(null);
  const [data, setData] = useState<BottleneckData[]>([]);

  useEffect(() => {
    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆå®Ÿéš›ã¯APIã‹ã‚‰å–å¾—ï¼‰
    const mockData: BottleneckData[] = [
      {
        stage: "è¦ä»¶å®šç¾©",
        averageTime: 2.5,
        taskCount: 15,
        isBottleneck: false,
      },
      { stage: "è¨­è¨ˆ", averageTime: 1.8, taskCount: 12, isBottleneck: false },
      { stage: "å®Ÿè£…", averageTime: 3.2, taskCount: 45, isBottleneck: false },
      {
        stage: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼",
        averageTime: 4.8,
        taskCount: 38,
        isBottleneck: true,
      },
      { stage: "ãƒ†ã‚¹ãƒˆ", averageTime: 2.1, taskCount: 20, isBottleneck: false },
      {
        stage: "ãƒ‡ãƒ—ãƒ­ã‚¤",
        averageTime: 0.5,
        taskCount: 10,
        isBottleneck: false,
      },
    ];
    setData(mockData);
  }, []);

  useEffect(() => {
    if (!svgRef.current || data.length === 0) return;

    const margin = { top: 40, right: 80, bottom: 60, left: 80 };
    const width = 800 - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;

    // SVGã‚’ã‚¯ãƒªã‚¢
    d3.select(svgRef.current).selectAll("*").remove();

    const svg = d3
      .select(svgRef.current)
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);

    const g = svg
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // ã‚¹ã‚±ãƒ¼ãƒ«ã®è¨­å®š
    const x = d3
      .scaleBand()
      .range([0, width])
      .domain(data.map((d) => d.stage))
      .padding(0.2);

    const y = d3
      .scaleLinear()
      .range([height, 0])
      .domain([0, d3.max(data, (d) => d.averageTime) || 0]);

    // Xè»¸
    g.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x))
      .selectAll("text")
      .style("text-anchor", "end")
      .attr("dx", "-.8em")
      .attr("dy", ".15em")
      .attr("transform", "rotate(-45)");

    // Yè»¸
    g.append("g")
      .call(d3.axisLeft(y))
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left)
      .attr("x", 0 - height / 2)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .text("å¹³å‡æ»ç•™æ™‚é–“ï¼ˆæ—¥ï¼‰");

    // ãƒãƒ¼ã®æç”»
    g.selectAll(".bar")
      .data(data)
      .enter()
      .append("rect")
      .attr("class", "bar")
      .attr("x", (d) => x(d.stage) || 0)
      .attr("width", x.bandwidth())
      .attr("y", (d) => y(d.averageTime))
      .attr("height", (d) => height - y(d.averageTime))
      .attr("fill", (d) => (d.isBottleneck ? "#ef4444" : "#3b82f6"))
      .on("mouseover", function (event, d) {
        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®è¡¨ç¤º
        const tooltip = d3
          .select("body")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 0);

        tooltip.transition().duration(200).style("opacity", 0.9);
        tooltip
          .html(
            `<strong>${d.stage}</strong><br/>
             å¹³å‡æ™‚é–“: ${d.averageTime}æ—¥<br/>
             ã‚¿ã‚¹ã‚¯æ•°: ${d.taskCount}`
          )
          .style("left", event.pageX + "px")
          .style("top", event.pageY - 28 + "px");
      })
      .on("mouseout", function () {
        d3.selectAll(".tooltip").remove();
      });

    // ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®å¼·èª¿
    g.selectAll(".bottleneck-label")
      .data(data.filter((d) => d.isBottleneck))
      .enter()
      .append("text")
      .attr("class", "bottleneck-label")
      .attr("x", (d) => (x(d.stage) || 0) + x.bandwidth() / 2)
      .attr("y", (d) => y(d.averageTime) - 10)
      .attr("text-anchor", "middle")
      .style("fill", "#ef4444")
      .style("font-weight", "bold")
      .text("ãƒœãƒˆãƒ«ãƒãƒƒã‚¯");
  }, [data]);

  return (
    <Card>
      <CardHeader>
        <CardTitle>ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ</CardTitle>
      </CardHeader>
      <CardContent>
        <svg ref={svgRef}></svg>
        <div className="mt-4 text-sm text-gray-600">
          <p>
            â€»
            èµ¤ã„ãƒãƒ¼ã¯å¹³å‡æ»ç•™æ™‚é–“ãŒé•·ãã€ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã¨ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
          </p>
        </div>
      </CardContent>
    </Card>
  );
}
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ Next.js 14 ã® App Router ã‚’æ¡ç”¨ã—ã€ãƒ¢ãƒ€ãƒ³ãª React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã«å¾“ã£ã¦ã„ã¾ã™ã€‚

### Redux Store ã®è¨­è¨ˆæ€æƒ³

çŠ¶æ…‹ç®¡ç†ã¯ Redux Toolkit ã‚’ä½¿ç”¨ã—ã€äºˆæ¸¬å¯èƒ½ã§ä¿å®ˆã—ã‚„ã™ã„è¨­è¨ˆã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

```typescript
// frontend/src/store/index.ts

import { configureStore } from "@reduxjs/toolkit";
import authReducer from "./slices/authSlice";
// import projectReducer from "./slices/projectSlice"; // æœªå®Ÿè£…
// import analyticsReducer from "./slices/analyticsSlice"; // æœªå®Ÿè£…

export const store = configureStore({
  reducer: {
    auth: authReducer,
    // project: projectReducer,
    // analytics: analyticsReducer,
  },
  middleware: (getDefaultMiddleware) =>
    getDefaultMiddleware({
      serializableCheck: {
        // Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãªã©ã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºä¸å¯èƒ½ãªå€¤ã‚’è¨±å¯
        ignoredActions: ["auth/setUser"],
        ignoredPaths: ["auth.user.createdAt", "auth.user.updatedAt"],
      },
    }),
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

### Services ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…

API é€šä¿¡ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã‚¯ãƒ©ã‚¹ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å®Ÿè£…ã®è©³ç´°ã‚’éš è”½ã—ã¾ã™ã€‚

```typescript
// frontend/src/services/auth.service.ts

import axios from "axios";
import { API_BASE_URL } from "@/app/api/config";

interface LoginResponse {
  authorization_url: string;
  state: string;
}

interface CallbackResponse {
  access_token: string;
  token_type: string;
  user: {
    id: number;
    backlog_id: number;
    email: string;
    name: string;
    user_id: string;
  };
}

class AuthService {
  private baseURL = `${API_BASE_URL}/auth`;

  async getAuthorizationUrl(): Promise<LoginResponse> {
    try {
      const response = await axios.get(`${this.baseURL}/backlog/authorize`);
      return response.data;
    } catch (error) {
      console.error("èªè¨¼URLå–å¾—ã‚¨ãƒ©ãƒ¼:", error);
      throw new Error("èªè¨¼URLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
  }

  async handleCallback(code: string, state: string): Promise<CallbackResponse> {
    try {
      const response = await axios.post(`${this.baseURL}/backlog/callback`, {
        code,
        state,
      });
      return response.data;
    } catch (error) {
      console.error("ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†ã‚¨ãƒ©ãƒ¼:", error);
      throw new Error("èªè¨¼å‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
  }

  async logout(): Promise<void> {
    try {
      await axios.post(`${this.baseURL}/logout`);
    } catch (error) {
      console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
      throw new Error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
  }

  async getCurrentUser() {
    try {
      const response = await axios.get(`${this.baseURL}/me`);
      return response.data;
    } catch (error) {
      console.error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
      throw new Error("ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
  }
}

export const authService = new AuthService();
```

### ã‚«ã‚¹ã‚¿ãƒ  Hooks ã®æ´»ç”¨

ãƒ­ã‚¸ãƒƒã‚¯ã‚’å†åˆ©ç”¨å¯èƒ½ãªå½¢ã§ã‚«ãƒ—ã‚»ãƒ«åŒ–ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ä¿ã¡ã¾ã™ã€‚

```typescript
// frontend/src/hooks/useAuth.ts

import { useEffect, useCallback } from "react";
import { useRouter } from "next/navigation";
import { useAppDispatch, useAppSelector } from "@/store/hooks";
import { setUser, clearUser, setLoading } from "@/store/slices/authSlice";
import { authService } from "@/services/auth.service";

export function useAuth() {
  const dispatch = useAppDispatch();
  const router = useRouter();
  const { user, isAuthenticated, isLoading, isInitialized } = useAppSelector(
    (state) => state.auth
  );

  // åˆæœŸåŒ–æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
  useEffect(() => {
    const initAuth = async () => {
      try {
        const userData = await authService.getCurrentUser();
        dispatch(setUser(userData));
      } catch (error) {
        // æœªèªè¨¼ã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’ç„¡è¦–
        dispatch(clearUser());
      } finally {
        dispatch(setLoading(false));
      }
    };

    if (!isInitialized) {
      initAuth();
    }
  }, [dispatch, isInitialized]);

  const login = useCallback(async () => {
    try {
      const { authorization_url, state } =
        await authService.getAuthorizationUrl();

      // stateã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã«æ¤œè¨¼ç”¨ï¼‰
      sessionStorage.setItem("oauth_state", state);

      // Backlogã®èªè¨¼ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      window.location.href = authorization_url;
    } catch (error) {
      console.error("ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:", error);
      throw error;
    }
  }, []);

  const handleCallback = useCallback(
    async (code: string, state: string) => {
      try {
        // stateã®æ¤œè¨¼
        const savedState = sessionStorage.getItem("oauth_state");
        if (state !== savedState) {
          throw new Error("ä¸æ­£ãªèªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™");
        }

        // èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ãƒˆãƒ¼ã‚¯ãƒ³ã«äº¤æ›
        const response = await authService.handleCallback(code, state);

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
        dispatch(setUser(response.user));

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
        sessionStorage.removeItem("oauth_state");

        return response;
      } catch (error) {
        console.error("ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚¨ãƒ©ãƒ¼:", error);
        throw error;
      }
    },
    [dispatch]
  );

  const logout = useCallback(async () => {
    try {
      await authService.logout();
      dispatch(clearUser());
      router.push("/");
    } catch (error) {
      console.error("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼:", error);
      // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã®çŠ¶æ…‹ã¯ã‚¯ãƒªã‚¢
      dispatch(clearUser());
      router.push("/");
    }
  }, [dispatch, router]);

  return {
    user,
    isAuthenticated,
    isLoading,
    isInitialized,
    login,
    logout,
    handleCallback,
  };
}
```

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³èª¬

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ FastAPI ã‚’ä½¿ç”¨ã—ã€é«˜æ€§èƒ½ã§å‹å®‰å…¨ãª API ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚

### FastAPI ã®åŸºç¤ã¨å¿œç”¨

FastAPI ã¯ Python ã®å‹ãƒ’ãƒ³ãƒˆã‚’æ´»ç”¨ã—ã¦ã€è‡ªå‹•çš„ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã‚’è¡Œã„ã¾ã™ã€‚

```python
# backend/app/main.py

from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
import logging
from app.api.v1 import auth
from app.core.config import settings
from app.db.session import engine
from app.db import base

# ãƒ­ã‚°è¨­å®š
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ã®ä½œæˆ
base.Base.metadata.create_all(bind=engine)

# FastAPIã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆ
app = FastAPI(
    title="Team Insight API",
    description="é–‹ç™ºãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’å¯è¦–åŒ–ã™ã‚‹APIã‚µãƒ¼ãƒ“ã‚¹",
    version="1.0.0",
    docs_url="/api/docs",
    redoc_url="/api/redoc",
)

# CORSè¨­å®š
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.BACKEND_CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
@app.exception_handler(Exception)
async def global_exception_handler(request: Request, exc: Exception):
    logger.error(f"Unhandled exception: {exc}", exc_info=True)
    return JSONResponse(
        status_code=500,
        content={"detail": "å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ"},
    )

# APIãƒ«ãƒ¼ã‚¿ãƒ¼ã®ç™»éŒ²
app.include_router(auth.router, prefix="/api/v1")

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@app.get("/health")
async def health_check():
    """APIã®ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèª"""
    return {
        "status": "healthy",
        "version": "1.0.0",
        "service": "Team Insight API"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã®è©³ç´°

SQLAlchemy ã‚’ä½¿ç”¨ã—ã¦ã€å‹å®‰å…¨ã§ãƒ¡ãƒ³ãƒ†ãƒŠãƒ–ãƒ«ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã‚’å®šç¾©ã—ã¾ã™ã€‚

```python
# backend/app/models/user.py

from sqlalchemy import Column, Integer, String, Boolean, DateTime
from sqlalchemy.orm import relationship
from app.db.base_class import Base
from datetime import datetime

class User(Base):
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«

    Backlogã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã¨é€£æºã—ã€Team Insightå†…ã§ã®
    æ¨©é™ç®¡ç†ã‚„ãƒ‡ãƒ¼ã‚¿ã®ç´ä»˜ã‘ã«ä½¿ç”¨ã•ã‚Œã‚‹
    """
    __tablename__ = "users"
    __table_args__ = {"schema": "team_insight"}

    id = Column(Integer, primary_key=True, index=True)
    backlog_id = Column(Integer, unique=True, nullable=False, index=True)
    user_id = Column(String, unique=True, nullable=False)  # Backlogã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
    email = Column(String, unique=True, index=True)
    name = Column(String, nullable=False)
    role = Column(String, default="member")  # member, leader, admin
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    oauth_tokens = relationship("OAuthToken", back_populates="user", cascade="all, delete-orphan")

    def __repr__(self):
        return f"<User(id={self.id}, name={self.name}, role={self.role})>"

    @property
    def is_admin(self):
        """ç®¡ç†è€…æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹"""
        return self.role == "admin"

    @property
    def is_leader(self):
        """ãƒªãƒ¼ãƒ€ãƒ¼æ¨©é™ä»¥ä¸Šã‚’æŒã£ã¦ã„ã‚‹ã‹"""
        return self.role in ["leader", "admin"]
```

```python
# backend/app/models/auth.py

from sqlalchemy import Column, Integer, String, ForeignKey, DateTime, Text
from sqlalchemy.orm import relationship
from app.db.base_class import Base
from datetime import datetime

class OAuthToken(Base):
    """
    OAuthãƒˆãƒ¼ã‚¯ãƒ³ãƒ¢ãƒ‡ãƒ«

    Backlog APIã‚¢ã‚¯ã‚»ã‚¹ç”¨ã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä¿å­˜
    """
    __tablename__ = "oauth_tokens"
    __table_args__ = {"schema": "team_insight"}

    id = Column(Integer, primary_key=True, index=True)
    user_id = Column(Integer, ForeignKey("team_insight.users.id"), nullable=False)
    provider = Column(String, default="backlog")
    access_token = Column(Text, nullable=False)
    refresh_token = Column(Text)
    expires_at = Column(DateTime)
    created_at = Column(DateTime, default=datetime.utcnow)
    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)

    # ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    user = relationship("User", back_populates="oauth_tokens")

    @property
    def is_expired(self):
        """ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã‚‹ã‹"""
        if not self.expires_at:
            return False
        return datetime.utcnow() > self.expires_at

class OAuthState(Base):
    """
    OAuthèªè¨¼ã®stateãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

    CSRFæ”»æ’ƒã‚’é˜²ããŸã‚ã®ä¸€æ™‚çš„ãªãƒˆãƒ¼ã‚¯ãƒ³
    """
    __tablename__ = "oauth_states"
    __table_args__ = {"schema": "team_insight"}

    id = Column(Integer, primary_key=True, index=True)
    state = Column(String, unique=True, nullable=False, index=True)
    expires_at = Column(DateTime, nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)

    @property
    def is_expired(self):
        """stateã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã‚‹ã‹"""
        return datetime.utcnow() > self.expires_at
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å®Ÿè£…ã®å®Œå…¨ç†è§£

```python
# backend/app/core/dependencies.py

from fastapi import Depends, HTTPException, status
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
from sqlalchemy.orm import Session
from jose import JWTError
from app.db.session import get_db
from app.core.security import verify_token
from app.models.user import User

security = HTTPBearer()

async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security),
    db: Session = Depends(get_db)
) -> User:
    """
    ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹ä¾å­˜æ€§æ³¨å…¥

    JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
    """
    token = credentials.credentials

    try:
        # ãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼
        payload = verify_token(token)
        user_id: int = int(payload.get("sub"))

        if user_id is None:
            raise HTTPException(
                status_code=status.HTTP_401_UNAUTHORIZED,
                detail="ç„¡åŠ¹ãªèªè¨¼æƒ…å ±ã§ã™"
            )
    except JWTError:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="èªè¨¼æƒ…å ±ã®æ¤œè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ"
        )

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—
    user = db.query(User).filter(User.id == user_id).first()
    if user is None:
        raise HTTPException(
            status_code=status.HTTP_404_NOT_FOUND,
            detail="ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
        )

    if not user.is_active:
        raise HTTPException(
            status_code=status.HTTP_400_BAD_REQUEST,
            detail="ç„¡åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™"
        )

    return user

async def get_current_active_user(
    current_user: User = Depends(get_current_user)
) -> User:
    """ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚’è¨±å¯"""
    if not current_user.is_active:
        raise HTTPException(status_code=400, detail="ç„¡åŠ¹ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã™")
    return current_user

async def get_current_admin_user(
    current_user: User = Depends(get_current_active_user)
) -> User:
    """ç®¡ç†è€…æ¨©é™ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ã‚’è¨±å¯"""
    if not current_user.is_admin:
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="ã“ã®æ“ä½œã«ã¯ç®¡ç†è€…æ¨©é™ãŒå¿…è¦ã§ã™"
        )
    return current_user
```

---

## D3.js ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å¯è¦–åŒ–

D3.js ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã§ç¾ã—ã„ãƒ‡ãƒ¼ã‚¿ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã—ã¾ã™ã€‚

### ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ãƒãƒ£ãƒ¼ãƒˆã®å®Ÿè£…

```typescript
// frontend/src/components/dashboard/BottleneckChart.tsx ã®è©³ç´°å®Ÿè£…

import React, { useEffect, useRef, useState } from "react";
import * as d3 from "d3";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { AlertCircle } from "lucide-react";

interface BottleneckData {
  stage: string;
  averageTime: number;
  taskCount: number;
  trend: "up" | "down" | "stable";
  details: {
    minTime: number;
    maxTime: number;
    median: number;
  };
}

export function BottleneckChart() {
  const svgRef = useRef<SVGSVGElement>(null);
  const containerRef = useRef<HTMLDivElement>(null);
  const [data, setData] = useState<BottleneckData[]>([]);
  const [selectedStage, setSelectedStage] = useState<string | null>(null);

  // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
  useEffect(() => {
    const handleResize = () => {
      if (svgRef.current && containerRef.current) {
        drawChart();
      }
    };

    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, [data]);

  const drawChart = () => {
    if (!svgRef.current || !containerRef.current || data.length === 0) return;

    const containerWidth = containerRef.current.clientWidth;
    const margin = { top: 40, right: 120, bottom: 80, left: 80 };
    const width = containerWidth - margin.left - margin.right;
    const height = 400 - margin.top - margin.bottom;

    // SVGã‚’ã‚¯ãƒªã‚¢
    d3.select(svgRef.current).selectAll("*").remove();

    const svg = d3
      .select(svgRef.current)
      .attr("width", containerWidth)
      .attr("height", height + margin.top + margin.bottom);

    const g = svg
      .append("g")
      .attr("transform", `translate(${margin.left},${margin.top})`);

    // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®šç¾©
    const defs = svg.append("defs");

    // é€šå¸¸ã®ãƒãƒ¼ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const normalGradient = defs
      .append("linearGradient")
      .attr("id", "normal-gradient")
      .attr("x1", "0%")
      .attr("y1", "0%")
      .attr("x2", "0%")
      .attr("y2", "100%");

    normalGradient
      .append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#60a5fa")
      .attr("stop-opacity", 1);

    normalGradient
      .append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#3b82f6")
      .attr("stop-opacity", 1);

    // ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const bottleneckGradient = defs
      .append("linearGradient")
      .attr("id", "bottleneck-gradient")
      .attr("x1", "0%")
      .attr("y1", "0%")
      .attr("x2", "0%")
      .attr("y2", "100%");

    bottleneckGradient
      .append("stop")
      .attr("offset", "0%")
      .attr("stop-color", "#f87171")
      .attr("stop-opacity", 1);

    bottleneckGradient
      .append("stop")
      .attr("offset", "100%")
      .attr("stop-color", "#ef4444")
      .attr("stop-opacity", 1);

    // ã‚¹ã‚±ãƒ¼ãƒ«ã®è¨­å®š
    const x = d3
      .scaleBand()
      .range([0, width])
      .domain(data.map((d) => d.stage))
      .padding(0.3);

    const y = d3
      .scaleLinear()
      .range([height, 0])
      .domain([0, d3.max(data, (d) => d.averageTime) || 0])
      .nice();

    // èƒŒæ™¯ã‚°ãƒªãƒƒãƒ‰ã®è¿½åŠ 
    g.append("g")
      .attr("class", "grid")
      .attr("transform", `translate(0,${height})`)
      .call(
        d3
          .axisBottom(x)
          .tickSize(-height)
          .tickFormat(() => "")
      )
      .style("stroke-dasharray", "3,3")
      .style("opacity", 0.3);

    g.append("g")
      .attr("class", "grid")
      .call(
        d3
          .axisLeft(y)
          .tickSize(-width)
          .tickFormat(() => "")
      )
      .style("stroke-dasharray", "3,3")
      .style("opacity", 0.3);

    // Xè»¸
    g.append("g")
      .attr("transform", `translate(0,${height})`)
      .call(d3.axisBottom(x))
      .selectAll("text")
      .style("text-anchor", "end")
      .attr("dx", "-.8em")
      .attr("dy", ".15em")
      .attr("transform", "rotate(-45)")
      .style("font-size", "12px");

    // Yè»¸
    const yAxis = g.append("g").call(d3.axisLeft(y));

    yAxis
      .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 0 - margin.left + 20)
      .attr("x", 0 - height / 2)
      .attr("dy", "1em")
      .style("text-anchor", "middle")
      .style("fill", "#666")
      .style("font-size", "14px")
      .text("å¹³å‡æ»ç•™æ™‚é–“ï¼ˆæ—¥ï¼‰");

    // ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®é–¾å€¤ãƒ©ã‚¤ãƒ³
    const threshold = d3.mean(data, (d) => d.averageTime) || 0;

    g.append("line")
      .attr("x1", 0)
      .attr("x2", width)
      .attr("y1", y(threshold * 1.5))
      .attr("y2", y(threshold * 1.5))
      .attr("stroke", "#ef4444")
      .attr("stroke-width", 2)
      .attr("stroke-dasharray", "5,5")
      .style("opacity", 0.7);

    g.append("text")
      .attr("x", width - 5)
      .attr("y", y(threshold * 1.5) - 5)
      .attr("text-anchor", "end")
      .style("fill", "#ef4444")
      .style("font-size", "12px")
      .text("ãƒœãƒˆãƒ«ãƒãƒƒã‚¯é–¾å€¤");

    // ãƒãƒ¼ã®æç”»ï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãï¼‰
    const bars = g
      .selectAll(".bar")
      .data(data)
      .enter()
      .append("rect")
      .attr("class", "bar")
      .attr("x", (d) => x(d.stage) || 0)
      .attr("width", x.bandwidth())
      .attr("y", height)
      .attr("height", 0)
      .attr("fill", (d) =>
        d.averageTime > threshold * 1.5
          ? "url(#bottleneck-gradient)"
          : "url(#normal-gradient)"
      )
      .attr("rx", 4)
      .attr("ry", 4)
      .style("cursor", "pointer")
      .on("click", (event, d) => {
        setSelectedStage(d.stage === selectedStage ? null : d.stage);
      });

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    bars
      .transition()
      .duration(800)
      .delay((d, i) => i * 100)
      .attr("y", (d) => y(d.averageTime))
      .attr("height", (d) => height - y(d.averageTime));

    // å€¤ãƒ©ãƒ™ãƒ«ã®è¿½åŠ 
    g.selectAll(".value-label")
      .data(data)
      .enter()
      .append("text")
      .attr("class", "value-label")
      .attr("x", (d) => (x(d.stage) || 0) + x.bandwidth() / 2)
      .attr("y", (d) => y(d.averageTime) - 5)
      .attr("text-anchor", "middle")
      .style("font-size", "12px")
      .style("font-weight", "bold")
      .style("opacity", 0)
      .text((d) => `${d.averageTime}æ—¥`)
      .transition()
      .duration(800)
      .delay((d, i) => i * 100 + 400)
      .style("opacity", 1);

    // ãƒˆãƒ¬ãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼
    g.selectAll(".trend-indicator")
      .data(data)
      .enter()
      .append("text")
      .attr("class", "trend-indicator")
      .attr("x", (d) => (x(d.stage) || 0) + x.bandwidth() - 10)
      .attr("y", 20)
      .attr("text-anchor", "middle")
      .style("font-size", "16px")
      .text((d) => {
        if (d.trend === "up") return "â†‘";
        if (d.trend === "down") return "â†“";
        return "â†’";
      })
      .style("fill", (d) => {
        if (d.trend === "up") return "#ef4444";
        if (d.trend === "down") return "#10b981";
        return "#6b7280";
      });

    // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
    const tooltip = d3
      .select("body")
      .append("div")
      .attr("class", "tooltip")
      .style("position", "absolute")
      .style("padding", "12px")
      .style("background", "rgba(0, 0, 0, 0.9)")
      .style("color", "white")
      .style("border-radius", "8px")
      .style("font-size", "12px")
      .style("pointer-events", "none")
      .style("opacity", 0)
      .style("z-index", 1000);

    bars
      .on("mouseover", function (event, d) {
        d3.select(this).style("opacity", 0.8);

        tooltip.transition().duration(200).style("opacity", 1);
        tooltip
          .html(
            `<strong>${d.stage}</strong><br/>
             å¹³å‡æ™‚é–“: ${d.averageTime}æ—¥<br/>
             ã‚¿ã‚¹ã‚¯æ•°: ${d.taskCount}<br/>
             æœ€çŸ­: ${d.details.minTime}æ—¥<br/>
             æœ€é•·: ${d.details.maxTime}æ—¥<br/>
             ä¸­å¤®å€¤: ${d.details.median}æ—¥`
          )
          .style("left", event.pageX + 10 + "px")
          .style("top", event.pageY - 10 + "px");
      })
      .on("mouseout", function () {
        d3.select(this).style("opacity", 1);
        tooltip.transition().duration(200).style("opacity", 0);
      });

    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    return () => {
      tooltip.remove();
    };
  };

  useEffect(() => {
    // APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆç¾åœ¨ã¯ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
    const mockData: BottleneckData[] = [
      {
        stage: "è¦ä»¶å®šç¾©",
        averageTime: 2.5,
        taskCount: 15,
        trend: "stable",
        details: { minTime: 1, maxTime: 5, median: 2.3 },
      },
      {
        stage: "è¨­è¨ˆ",
        averageTime: 1.8,
        taskCount: 12,
        trend: "down",
        details: { minTime: 0.5, maxTime: 3, median: 1.7 },
      },
      {
        stage: "å®Ÿè£…",
        averageTime: 3.2,
        taskCount: 45,
        trend: "stable",
        details: { minTime: 1, maxTime: 8, median: 3.0 },
      },
      {
        stage: "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼",
        averageTime: 4.8,
        taskCount: 38,
        trend: "up",
        details: { minTime: 2, maxTime: 10, median: 4.5 },
      },
      {
        stage: "ãƒ†ã‚¹ãƒˆ",
        averageTime: 2.1,
        taskCount: 20,
        trend: "down",
        details: { minTime: 1, maxTime: 4, median: 2.0 },
      },
      {
        stage: "ãƒ‡ãƒ—ãƒ­ã‚¤",
        averageTime: 0.5,
        taskCount: 10,
        trend: "stable",
        details: { minTime: 0.2, maxTime: 1, median: 0.5 },
      },
    ];
    setData(mockData);
  }, []);

  useEffect(() => {
    drawChart();
  }, [data]);

  return (
    <Card className="w-full">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle>ãƒœãƒˆãƒ«ãƒãƒƒã‚¯åˆ†æ</CardTitle>
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <AlertCircle className="h-4 w-4" />
            <span>ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¡¨ç¤º</span>
          </div>
        </div>
      </CardHeader>
      <CardContent>
        <div ref={containerRef} className="w-full">
          <svg ref={svgRef}></svg>
        </div>

        {selectedStage && (
          <div className="mt-6 p-4 bg-gray-50 rounded-lg">
            <h4 className="font-semibold mb-2">{selectedStage}ã®è©³ç´°åˆ†æ</h4>
            <div className="grid grid-cols-2 gap-4 text-sm">
              <div>
                <p className="text-gray-600">æ”¹å–„æ¡ˆï¼š</p>
                <ul className="list-disc list-inside mt-1">
                  <li>ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã®å¢—å“¡ã‚’æ¤œè¨</li>
                  <li>è‡ªå‹•ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ„ãƒ¼ãƒ«ã®å°å…¥</li>
                  <li>ãƒ¬ãƒ“ãƒ¥ãƒ¼åŸºæº–ã®æ˜ç¢ºåŒ–</li>
                </ul>
              </div>
              <div>
                <p className="text-gray-600">é–¢é€£ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼š</p>
                <ul className="mt-1">
                  <li>å¹³å‡ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆæ•°: 12ä»¶</li>
                  <li>å†ãƒ¬ãƒ“ãƒ¥ãƒ¼ç‡: 35%</li>
                  <li>ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼æ•°: 3å</li>
                </ul>
              </div>
            </div>
          </div>
        )}

        <div className="mt-4 flex items-center gap-6 text-sm">
          <div className="flex items-center gap-2">
            <div
              className="w-4 h-4 rounded"
              style={{ background: "linear-gradient(#60a5fa, #3b82f6)" }}
            ></div>
            <span>æ­£å¸¸</span>
          </div>
          <div className="flex items-center gap-2">
            <div
              className="w-4 h-4 rounded"
              style={{ background: "linear-gradient(#f87171, #ef4444)" }}
            ></div>
            <span>ãƒœãƒˆãƒ«ãƒãƒƒã‚¯</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-red-500">â†‘</span>
            <span>æ‚ªåŒ–å‚¾å‘</span>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-green-500">â†“</span>
            <span>æ”¹å–„å‚¾å‘</span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

### å¥åº·åº¦ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚²ãƒ¼ã‚¸ã®å®Ÿè£…

```typescript
// frontend/src/components/dashboard/HealthGauge.tsx

import React, { useEffect, useRef } from "react";
import * as d3 from "d3";

interface HealthGaugeProps {
  value: number; // 0-100
  title: string;
  thresholds: {
    critical: number;
    warning: number;
    good: number;
  };
}

export function HealthGauge({ value, title, thresholds }: HealthGaugeProps) {
  const svgRef = useRef<SVGSVGElement>(null);

  useEffect(() => {
    if (!svgRef.current) return;

    const width = 200;
    const height = 160;
    const radius = Math.min(width, height) / 2 - 20;

    // SVGã‚’ã‚¯ãƒªã‚¢
    d3.select(svgRef.current).selectAll("*").remove();

    const svg = d3
      .select(svgRef.current)
      .attr("width", width)
      .attr("height", height);

    const g = svg
      .append("g")
      .attr("transform", `translate(${width / 2},${height - 20})`);

    // è§’åº¦ã‚¹ã‚±ãƒ¼ãƒ«
    const angleScale = d3
      .scaleLinear()
      .domain([0, 100])
      .range([-Math.PI / 2, Math.PI / 2]);

    // èƒŒæ™¯ã‚¢ãƒ¼ã‚¯
    const backgroundArc = d3
      .arc()
      .innerRadius(radius - 20)
      .outerRadius(radius)
      .startAngle(-Math.PI / 2)
      .endAngle(Math.PI / 2);

    g.append("path").attr("d", backgroundArc).style("fill", "#e5e7eb");

    // ã‚«ãƒ©ãƒ¼ã‚¹ã‚±ãƒ¼ãƒ«
    const colorScale = d3
      .scaleThreshold()
      .domain([thresholds.critical, thresholds.warning, thresholds.good])
      .range(["#ef4444", "#f59e0b", "#eab308", "#10b981"]);

    // å€¤ã®ã‚¢ãƒ¼ã‚¯
    const valueArc = d3
      .arc()
      .innerRadius(radius - 20)
      .outerRadius(radius)
      .startAngle(-Math.PI / 2)
      .endAngle(angleScale(0));

    const valuePath = g
      .append("path")
      .datum({ endAngle: angleScale(0) })
      .attr("d", valueArc)
      .style("fill", colorScale(value));

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    valuePath
      .transition()
      .duration(1000)
      .attrTween("d", function (d) {
        const interpolate = d3.interpolate(d.endAngle, angleScale(value));
        return function (t) {
          d.endAngle = interpolate(t);
          return valueArc(d);
        };
      });

    // ç›®ç››ã‚Š
    const ticks = [0, 25, 50, 75, 100];

    g.selectAll(".tick")
      .data(ticks)
      .enter()
      .append("line")
      .attr("class", "tick")
      .attr("x1", (d) => Math.cos(angleScale(d)) * (radius - 25))
      .attr("y1", (d) => Math.sin(angleScale(d)) * (radius - 25))
      .attr("x2", (d) => Math.cos(angleScale(d)) * (radius - 30))
      .attr("y2", (d) => Math.sin(angleScale(d)) * (radius - 30))
      .style("stroke", "#9ca3af")
      .style("stroke-width", 2);

    // ç›®ç››ã‚Šãƒ©ãƒ™ãƒ«
    g.selectAll(".tick-label")
      .data(ticks)
      .enter()
      .append("text")
      .attr("class", "tick-label")
      .attr("x", (d) => Math.cos(angleScale(d)) * (radius - 40))
      .attr("y", (d) => Math.sin(angleScale(d)) * (radius - 40) + 5)
      .attr("text-anchor", "middle")
      .style("font-size", "10px")
      .style("fill", "#6b7280")
      .text((d) => d);

    // é‡
    const needle = g
      .append("line")
      .attr("x1", 0)
      .attr("y1", 0)
      .attr("x2", 0)
      .attr("y2", -radius + 30)
      .style("stroke", "#374151")
      .style("stroke-width", 3)
      .attr("transform", `rotate(${-90})`);

    needle
      .transition()
      .duration(1000)
      .attr("transform", `rotate(${angleScale(value) * (180 / Math.PI) - 90})`);

    // ä¸­å¿ƒã®å††
    g.append("circle").attr("r", 5).style("fill", "#374151");

    // å€¤ã®ãƒ†ã‚­ã‚¹ãƒˆ
    const valueText = g
      .append("text")
      .attr("y", -20)
      .attr("text-anchor", "middle")
      .style("font-size", "24px")
      .style("font-weight", "bold")
      .style("fill", colorScale(value))
      .text("0");

    valueText
      .transition()
      .duration(1000)
      .tween("text", function () {
        const interpolate = d3.interpolate(0, value);
        return function (t) {
          this.textContent = Math.round(interpolate(t)).toString();
        };
      });

    // ã‚¿ã‚¤ãƒˆãƒ«
    g.append("text")
      .attr("y", 15)
      .attr("text-anchor", "middle")
      .style("font-size", "14px")
      .style("fill", "#4b5563")
      .text(title);
  }, [value, title, thresholds]);

  return <svg ref={svgRef}></svg>;
}
```

---

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

Team Insight ã®é–‹ç™ºç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹æ‰‹é †ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

### å‰ææ¡ä»¶

é–‹ç™ºã‚’å§‹ã‚ã‚‹å‰ã«ã€ä»¥ä¸‹ã®ãƒ„ãƒ¼ãƒ«ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- **Node.js** (v18.0.0 ä»¥ä¸Š)
- **Python** (v3.11 ä»¥ä¸Š)
- **PostgreSQL** (v14 ä»¥ä¸Š)
- **Git**
- **Docker** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã€æ¨å¥¨)

### Step 1: ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/your-org/team-insight.git
cd team-insight
```

### Step 2: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°

```bash
# backend/.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cd backend
cp .env.example .env
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼š

```env
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DATABASE_URL=postgresql://teaminsight:password@localhost:5432/teaminsight

# Backlog OAuthè¨­å®š
BACKLOG_SPACE_KEY=your-space-key
BACKLOG_CLIENT_ID=your-client-id
BACKLOG_CLIENT_SECRET=your-client-secret
BACKLOG_REDIRECT_URI=http://localhost:3000/auth/callback

# JWTè¨­å®š
SECRET_KEY=your-secret-key-here-change-this-in-production
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080  # 7æ—¥é–“

# CORSè¨­å®š
BACKEND_CORS_ORIGINS=["http://localhost:3000"]

# ç’°å¢ƒ
ENVIRONMENT=development
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°

```bash
# frontend/.env.localãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cd ../frontend
```

`.env.local`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```env
# APIè¨­å®š
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
NEXT_PUBLIC_APP_NAME=Team Insight
NEXT_PUBLIC_APP_VERSION=1.0.0
```

### Step 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### PostgreSQL ã®èµ·å‹•ï¼ˆDocker ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
docker-compose up -d postgres
```

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã‚¹ã‚­ãƒ¼ãƒã®ä½œæˆ

```sql
-- PostgreSQLã«æ¥ç¶š
psql -U postgres

-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
CREATE DATABASE teaminsight;

-- teaminsightãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶š
\c teaminsight

-- ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆ
CREATE SCHEMA team_insight;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
CREATE USER teaminsight WITH PASSWORD 'password';
GRANT ALL PRIVILEGES ON DATABASE teaminsight TO teaminsight;
GRANT ALL ON SCHEMA team_insight TO teaminsight;
```

### Step 4: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd backend

# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv venv

# ä»®æƒ³ç’°å¢ƒã‚’æœ‰åŠ¹åŒ–
# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
alembic upgrade head

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### Step 5: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
cd frontend

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install
# ã¾ãŸã¯
yarn install

# é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
npm run dev
# ã¾ãŸã¯
yarn dev
```

### Step 6: å‹•ä½œç¢ºèª

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒBacklog ã§ãƒ­ã‚°ã‚¤ãƒ³ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. Backlog ã®èªè¨¼ç”»é¢ã§ãƒ­ã‚°ã‚¤ãƒ³
4. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª

### Docker ã‚’ä½¿ç”¨ã—ãŸé–‹ç™ºç’°å¢ƒ

ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ Docker ã§èµ·å‹•ã™ã‚‹å ´åˆï¼š

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
docker-compose up -d

# ãƒ­ã‚°ã‚’ç¢ºèª
docker-compose logs -f

# ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢
docker-compose down
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

```bash
# PostgreSQLãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
docker-compose ps

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶šã§ãã‚‹ã‹ç¢ºèª
psql -h localhost -U teaminsight -d teaminsight
```

#### CORS ã‚¨ãƒ©ãƒ¼

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã§`BACKEND_CORS_ORIGINS`ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® URL ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã€‚

#### èªè¨¼ã‚¨ãƒ©ãƒ¼

1. Backlog ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ URI ãŒæ­£ã—ã„ã‹ç¢ºèª
2. ç’°å¢ƒå¤‰æ•°ã®`BACKLOG_CLIENT_ID`ã¨`BACKLOG_CLIENT_SECRET`ãŒæ­£ã—ã„ã‹ç¢ºèª

---

## ä»Šå¾Œã®å®Ÿè£…è¨ˆç”»

MVP å®Œæˆã«å‘ã‘ã¦ã€ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æ®µéšçš„ã«å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

### ãƒ•ã‚§ãƒ¼ã‚º 1: Backlog API é€£æºï¼ˆå„ªå…ˆåº¦: æœ€é«˜ï¼‰

#### 1.1 Backlog API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å®Ÿè£…

```python
# backend/app/services/backlog_api.py

from typing import List, Dict, Optional
from datetime import datetime, timedelta
import httpx
from app.core.config import settings
from app.models.user import User
from app.models.auth import OAuthToken

class BacklogAPIClient:
    """
    Backlog APIã¨ã®é€šä¿¡ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    """

    def __init__(self, access_token: str):
        self.access_token = access_token
        self.base_url = f"https://{settings.BACKLOG_SPACE_KEY}.backlog.jp/api/v2"
        self.headers = {
            "Authorization": f"Bearer {access_token}",
            "Content-Type": "application/json"
        }

    async def get_projects(self) -> List[Dict]:
        """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å–å¾—"""
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{self.base_url}/projects",
                headers=self.headers
            )
            response.raise_for_status()
            return response.json()

    async def get_issues(
        self,
        project_id: int,
        status_id: Optional[List[int]] = None,
        assigned_to_id: Optional[List[int]] = None,
        created_since: Optional[datetime] = None,
        updated_since: Optional[datetime] = None
    ) -> List[Dict]:
        """èª²é¡Œä¸€è¦§ã‚’å–å¾—"""
        params = {"projectId[]": project_id}

        if status_id:
            params["statusId[]"] = status_id
        if assigned_to_id:
            params["assigneeId[]"] = assigned_to_id
        if created_since:
            params["createdSince"] = created_since.isoformat()
        if updated_since:
            params["updatedSince"] = updated_since.isoformat()

        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{self.base_url}/issues",
                headers=self.headers,
                params=params
            )
            response.raise_for_status()
            return response.json()

    async def get_issue_statuses(self, project_id: int) -> List[Dict]:
        """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª²é¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ä¸€è¦§ã‚’å–å¾—"""
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{self.base_url}/projects/{project_id}/statuses",
                headers=self.headers
            )
            response.raise_for_status()
            return response.json()
```

#### 1.2 ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…

```python
# backend/app/services/data_sync_service.py

from datetime import datetime, timedelta
from typing import List, Dict
from sqlalchemy.orm import Session
from app.services.backlog_api import BacklogAPIClient
from app.models.project import Project, Issue, IssueStatusHistory
from app.models.user import User
from app.models.auth import OAuthToken
import logging

logger = logging.getLogger(__name__)

class DataSyncService:
    """
    Backlogã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹
    """

    def __init__(self, db: Session):
        self.db = db

    async def sync_user_data(self, user: User):
        """ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸ"""
        # OAuthãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
        token = self.db.query(OAuthToken).filter(
            OAuthToken.user_id == user.id
        ).first()

        if not token:
            raise ValueError("OAuthãƒˆãƒ¼ã‚¯ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")

        # ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ãƒã‚§ãƒƒã‚¯
        if token.is_expired:
            # TODO: ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒˆãƒ¼ã‚¯ãƒ³ã§æ›´æ–°
            raise ValueError("ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™")

        client = BacklogAPIClient(token.access_token)

        # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒæœŸ
        await self._sync_projects(client, user)

        # å„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®èª²é¡Œã‚’åŒæœŸ
        projects = self.db.query(Project).filter(
            Project.user_id == user.id
        ).all()

        for project in projects:
            await self._sync_project_issues(client, project)

    async def _sync_projects(self, client: BacklogAPIClient, user: User):
        """ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒæœŸ"""
        try:
            projects_data = await client.get_projects()

            for project_data in projects_data:
                # æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ¤œç´¢
                project = self.db.query(Project).filter(
                    Project.backlog_id == project_data["id"],
                    Project.user_id == user.id
                ).first()

                if not project:
                    # æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
                    project = Project(
                        backlog_id=project_data["id"],
                        user_id=user.id,
                        name=project_data["name"],
                        key=project_data["projectKey"],
                        description=project_data.get("description"),
                        is_archived=project_data.get("archived", False)
                    )
                    self.db.add(project)
                else:
                    # æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°
                    project.name = project_data["name"]
                    project.description = project_data.get("description")
                    project.is_archived = project_data.get("archived", False)

            self.db.commit()
            logger.info(f"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒæœŸå®Œäº†: {len(projects_data)}ä»¶")

        except Exception as e:
            logger.error(f"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåŒæœŸã‚¨ãƒ©ãƒ¼: {str(e)}")
            self.db.rollback()
            raise
```

### ãƒ•ã‚§ãƒ¼ã‚º 2: æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰

#### 2.1 ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ï¼ˆRBACï¼‰ã®å®Ÿè£…

```python
# backend/app/core/permissions.py

from enum import Enum
from typing import List
from fastapi import HTTPException, status
from app.models.user import User

class Role(str, Enum):
    ADMIN = "admin"
    LEADER = "leader"
    MEMBER = "member"

class Permission(str, Enum):
    # å€‹äººãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    VIEW_OWN_DASHBOARD = "view_own_dashboard"

    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    VIEW_PROJECT_DASHBOARD = "view_project_dashboard"
    MANAGE_PROJECT_SETTINGS = "manage_project_settings"

    # çµ„ç¹”ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    VIEW_ORGANIZATION_DASHBOARD = "view_organization_dashboard"

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
    MANAGE_USERS = "manage_users"

    # ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
    MANAGE_SYSTEM_SETTINGS = "manage_system_settings"

# ãƒ­ãƒ¼ãƒ«ã¨æ¨©é™ã®ãƒãƒƒãƒ”ãƒ³ã‚°
ROLE_PERMISSIONS = {
    Role.ADMIN: [
        Permission.VIEW_OWN_DASHBOARD,
        Permission.VIEW_PROJECT_DASHBOARD,
        Permission.MANAGE_PROJECT_SETTINGS,
        Permission.VIEW_ORGANIZATION_DASHBOARD,
        Permission.MANAGE_USERS,
        Permission.MANAGE_SYSTEM_SETTINGS,
    ],
    Role.LEADER: [
        Permission.VIEW_OWN_DASHBOARD,
        Permission.VIEW_PROJECT_DASHBOARD,
        Permission.MANAGE_PROJECT_SETTINGS,
    ],
    Role.MEMBER: [
        Permission.VIEW_OWN_DASHBOARD,
    ],
}

def check_permission(user: User, permission: Permission) -> bool:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰¹å®šã®æ¨©é™ã‚’æŒã£ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯"""
    user_permissions = ROLE_PERMISSIONS.get(Role(user.role), [])
    return permission in user_permissions

def require_permission(permission: Permission):
    """æ¨©é™ãƒã‚§ãƒƒã‚¯ãƒ‡ã‚³ãƒ¬ãƒ¼ã‚¿"""
    def decorator(func):
        async def wrapper(*args, current_user: User, **kwargs):
            if not check_permission(current_user, permission):
                raise HTTPException(
                    status_code=status.HTTP_403_FORBIDDEN,
                    detail=f"ã“ã®æ“ä½œã«ã¯{permission}æ¨©é™ãŒå¿…è¦ã§ã™"
                )
            return await func(*args, current_user=current_user, **kwargs)
        return wrapper
    return decorator
```

### ãƒ•ã‚§ãƒ¼ã‚º 3: é«˜åº¦ãªåˆ†ææ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

#### 3.1 ãƒœãƒˆãƒ«ãƒãƒƒã‚¯æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```python
# backend/app/services/analytics_service.py

from datetime import datetime, timedelta
from typing import List, Dict, Optional
from sqlalchemy.orm import Session
from sqlalchemy import func
from app.models.project import Issue, IssueStatusHistory
import numpy as np

class AnalyticsService:
    """
    åˆ†ææ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹
    """

    def __init__(self, db: Session):
        self.db = db

    def analyze_bottlenecks(
        self,
        project_id: int,
        start_date: Optional[datetime] = None,
        end_date: Optional[datetime] = None
    ) -> List[Dict]:
        """
        ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã‚’åˆ†æ

        å„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§ã®å¹³å‡æ»ç•™æ™‚é–“ã‚’è¨ˆç®—ã—ã€
        ç•°å¸¸ã«é•·ã„æ»ç•™æ™‚é–“ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç‰¹å®š
        """
        if not start_date:
            start_date = datetime.utcnow() - timedelta(days=30)
        if not end_date:
            end_date = datetime.utcnow()

        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å±¥æ­´ã‚’å–å¾—
        status_histories = self.db.query(
            IssueStatusHistory.status_name,
            func.avg(
                func.extract('epoch', IssueStatusHistory.exited_at - IssueStatusHistory.entered_at)
            ).label('avg_duration'),
            func.count(IssueStatusHistory.id).label('count')
        ).filter(
            IssueStatusHistory.project_id == project_id,
            IssueStatusHistory.entered_at >= start_date,
            IssueStatusHistory.entered_at <= end_date,
            IssueStatusHistory.exited_at.isnot(None)
        ).group_by(
            IssueStatusHistory.status_name
        ).all()

        # çµæœã‚’æ•´å½¢
        results = []
        durations = []

        for history in status_histories:
            avg_days = history.avg_duration / 86400 if history.avg_duration else 0
            durations.append(avg_days)

            results.append({
                "stage": history.status_name,
                "averageTime": round(avg_days, 2),
                "taskCount": history.count,
                "isBottleneck": False  # å¾Œã§åˆ¤å®š
            })

        # ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®åˆ¤å®šï¼ˆå¹³å‡ + 1.5 * æ¨™æº–åå·®ã‚’è¶…ãˆã‚‹å ´åˆï¼‰
        if durations:
            mean = np.mean(durations)
            std = np.std(durations)
            threshold = mean + 1.5 * std

            for result in results:
                if result["averageTime"] > threshold:
                    result["isBottleneck"] = True

        return results

    def calculate_velocity(
        self,
        project_id: int,
        sprint_duration_days: int = 14
    ) -> List[Dict]:
        """
        ãƒ™ãƒ­ã‚·ãƒ†ã‚£ï¼ˆå®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆåˆè¨ˆï¼‰ã‚’è¨ˆç®—
        """
        # ã‚¹ãƒ—ãƒªãƒ³ãƒˆã”ã¨ã®å®Œäº†ã‚¿ã‚¹ã‚¯æ•°ã‚’é›†è¨ˆ
        sprints = []
        current_date = datetime.utcnow()

        for i in range(6):  # éå»6ã‚¹ãƒ—ãƒªãƒ³ãƒˆ
            sprint_end = current_date - timedelta(days=i * sprint_duration_days)
            sprint_start = sprint_end - timedelta(days=sprint_duration_days)

            completed_count = self.db.query(func.count(Issue.id)).filter(
                Issue.project_id == project_id,
                Issue.completed_at >= sprint_start,
                Issue.completed_at < sprint_end
            ).scalar()

            sprints.append({
                "sprint": f"Sprint {6-i}",
                "startDate": sprint_start.isoformat(),
                "endDate": sprint_end.isoformat(),
                "completedTasks": completed_count,
                "velocity": completed_count * 3  # ä»®ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
            })

        return sprints

    def calculate_cycle_time(
        self,
        project_id: int,
        days: int = 30
    ) -> Dict:
        """
        ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ï¼ˆç€æ‰‹ã‹ã‚‰å®Œäº†ã¾ã§ã®æ™‚é–“ï¼‰ã‚’è¨ˆç®—
        """
        end_date = datetime.utcnow()
        start_date = end_date - timedelta(days=days)

        # æœŸé–“å†…ã«å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ ã‚’å–å¾—
        issues = self.db.query(
            Issue.id,
            Issue.started_at,
            Issue.completed_at
        ).filter(
            Issue.project_id == project_id,
            Issue.completed_at >= start_date,
            Issue.completed_at <= end_date,
            Issue.started_at.isnot(None)
        ).all()

        cycle_times = []
        for issue in issues:
            cycle_time = (issue.completed_at - issue.started_at).days
            cycle_times.append(cycle_time)

        if cycle_times:
            return {
                "average": round(np.mean(cycle_times), 2),
                "median": round(np.median(cycle_times), 2),
                "p75": round(np.percentile(cycle_times, 75), 2),
                "p90": round(np.percentile(cycle_times, 90), 2),
                "count": len(cycle_times)
            }
        else:
            return {
                "average": 0,
                "median": 0,
                "p75": 0,
                "p90": 0,
                "count": 0
            }
```

### ãƒ•ã‚§ãƒ¼ã‚º 4: UI/UX ã®æ”¹å–„ï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰

#### 4.1 ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ

```typescript
// frontend/src/contexts/ThemeContext.tsx

import React, { createContext, useContext, useEffect, useState } from "react";

type Theme = "light" | "dark";

interface ThemeContextType {
  theme: Theme;
  toggleTheme: () => void;
}

const ThemeContext = createContext<ThemeContextType | undefined>(undefined);

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setTheme] = useState<Theme>("light");

  useEffect(() => {
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰è¨­å®šã‚’èª­ã¿è¾¼ã¿
    const savedTheme = localStorage.getItem("theme") as Theme;
    if (savedTheme) {
      setTheme(savedTheme);
    } else {
      // ã‚·ã‚¹ãƒ†ãƒ ã®è¨­å®šã‚’ç¢ºèª
      const prefersDark = window.matchMedia(
        "(prefers-color-scheme: dark)"
      ).matches;
      setTheme(prefersDark ? "dark" : "light");
    }
  }, []);

  useEffect(() => {
    // ãƒ†ãƒ¼ãƒã‚’é©ç”¨
    document.documentElement.classList.toggle("dark", theme === "dark");
    localStorage.setItem("theme", theme);
  }, [theme]);

  const toggleTheme = () => {
    setTheme((prev) => (prev === "light" ? "dark" : "light"));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  );
}

export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error("useTheme must be used within a ThemeProvider");
  }
  return context;
}
```

---

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

#### TypeScript/React

1. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å‘½å**

   - PascalCase ã‚’ä½¿ç”¨: `UserProfile.tsx`
   - 1 ãƒ•ã‚¡ã‚¤ãƒ« 1 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

2. **å‹å®šç¾©**
   - `interface` ã‚’å„ªå…ˆçš„ã«ä½¿ç”¨
   - Props ã®å‹ã¯å¿…ãšå®šç¾©

```typescript
// Good
interface UserProfileProps {
  userId: string;
  onUpdate?: (user: User) => void;
}

export function UserProfile({ userId, onUpdate }: UserProfileProps) {
  // ...
}
```

3. **çŠ¶æ…‹ç®¡ç†**
   - ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã¯ `useState`
   - ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ã¯ Redux
   - ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹ã¯ React Queryï¼ˆå°†æ¥å®Ÿè£…ï¼‰

#### Python/FastAPI

1. **å‹ãƒ’ãƒ³ãƒˆã®ä½¿ç”¨**
   - ã™ã¹ã¦ã®é–¢æ•°ã«å‹ãƒ’ãƒ³ãƒˆã‚’è¿½åŠ 
   - Pydantic ãƒ¢ãƒ‡ãƒ«ã§è‡ªå‹•ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```python
# Good
async def get_user_by_id(user_id: int, db: Session) -> Optional[User]:
    return db.query(User).filter(User.id == user_id).first()
```

2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
   - é©åˆ‡ãª HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã™
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å…·ä½“çš„ã«

```python
# Good
if not user:
    raise HTTPException(
        status_code=404,
        detail=f"ID {user_id} ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    )
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

1. **èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å–ã‚Šæ‰±ã„**

   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: HttpOnly Cookie ã§ä¿å­˜
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: ç’°å¢ƒå¤‰æ•°ã§ç§˜å¯†éµã‚’ç®¡ç†

2. **å…¥åŠ›æ¤œè¨¼**

   - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: åŸºæœ¬çš„ãªæ¤œè¨¼
   - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: å®Œå…¨ãªæ¤œè¨¼ï¼ˆä¿¡é ¼å¢ƒç•Œï¼‰

3. **SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–**
   - SQLAlchemy ã® ORM ã‚’ä½¿ç”¨
   - ç”Ÿã® SQL ã¯é¿ã‘ã‚‹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®æœ€é©åŒ–**
   - N+1 å•é¡Œã‚’é¿ã‘ã‚‹
   - å¿…è¦ãªã‚«ãƒ©ãƒ ã®ã¿å–å¾—

```python
# Good - Eager Loading
users = db.query(User).options(
    joinedload(User.oauth_tokens)
).all()
```

2. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æœ€é©åŒ–**
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é©åˆ‡ãªåˆ†å‰²
   - `useMemo` ã¨ `useCallback` ã®æ´»ç”¨
   - ç”»åƒã®é…å»¶èª­ã¿è¾¼ã¿

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**

   - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¯å¿…ãšãƒ†ã‚¹ãƒˆ
   - ãƒ¢ãƒƒã‚¯ã‚’æ´»ç”¨

2. **çµ±åˆãƒ†ã‚¹ãƒˆ**

   - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - èªè¨¼ãƒ•ãƒ­ãƒ¼ã®ãƒ†ã‚¹ãƒˆ

3. **E2E ãƒ†ã‚¹ãƒˆ**
   - é‡è¦ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’ã‚«ãƒãƒ¼
   - Cypress ã‚„ Playwright ã‚’ä½¿ç”¨ï¼ˆå°†æ¥å®Ÿè£…ï¼‰

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### 1. CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« CORS ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹

**è§£æ±ºæ–¹æ³•**:

```python
# backend/app/core/config.py ã‚’ç¢ºèª
BACKEND_CORS_ORIGINS = [
    "http://localhost:3000",
    "http://localhost:3001",  # åˆ¥ãƒãƒ¼ãƒˆã§å‹•ã‹ã™å ´åˆ
]
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `sqlalchemy.exc.OperationalError`

**è§£æ±ºæ–¹æ³•**:

```bash
# PostgreSQLãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
sudo systemctl status postgresql

# æ¥ç¶šæƒ…å ±ã‚’ç¢ºèª
psql -h localhost -U teaminsight -d teaminsight
```

#### 3. JWT èªè¨¼ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: 401 Unauthorized ã‚¨ãƒ©ãƒ¼

**è§£æ±ºæ–¹æ³•**:

1. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ Cookie ã‚’ç¢ºèª
2. `auth_token` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
3. ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª

#### 4. Backlog API ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: Backlog API ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹

**è§£æ±ºæ–¹æ³•**:

1. API ã‚­ãƒ¼ã®æ¨©é™ã‚’ç¢ºèª
2. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«é”ã—ã¦ã„ãªã„ã‹ç¢ºèª
3. Backlog ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æƒ…å ±ã‚’ç¢ºèª

### ãƒ‡ãƒãƒƒã‚° Tips

1. **ãƒ­ã‚°ã®æ´»ç”¨**

```python
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
import logging
logger = logging.getLogger(__name__)
logger.info("ãƒ‡ãƒãƒƒã‚°æƒ…å ±")

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
console.log("ğŸ” ãƒ‡ãƒãƒƒã‚°:", data);
```

2. **ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½**

   - React Developer Tools
   - Redux DevTools

3. **API ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«**
   - FastAPI ã®è‡ªå‹•ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: http://localhost:8000/api/docs
   - Postman ã‚„ Insomnia

---

ã“ã‚Œã§ Team Insight ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã¯å®Œæˆã§ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’å‚è€ƒã«ã€åŠ¹ç‡çš„ã§ä¿å®ˆæ€§ã®é«˜ã„ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ï¼

ä½•ã‹è³ªå•ãŒã‚ã‚Œã°ã€é æ…®ãªãèã„ã¦ãã ã•ã„ã€‚Happy Coding! ğŸš€
